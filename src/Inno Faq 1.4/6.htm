<html xmlns=http://www.w3.org/1999/xhtml><head><meta http-equiv=Content-Type content="text/html; charset=windows-1251" /><title>Проценты</title><link rel=stylesheet type=text/css href=css.css /><script type="text/javascript" src="includer.js"></script>
<script language='JScript' type='text/javascript' src='copycode.js'></script>
</head><body><div id=heading><h1>» Inno Setup Faq. Проценты</h1></div><br />

<script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id=delphi_Tc4NTM>
<input type=button value="Копировать в буфер обмена" onClick="copyToClipboard( taCode1, theCode1 );" />
<blockquote id="theCode1"><font>
[Setup]<br />AppName=MyApp<br />AppVerName=MyApp<br />DefaultDirName={pf}\MyApp<br /><br />[Files]<br />Source: compiler:innocallback.dll; Flags: dontcopy<br />Source: {win}\Help\*; DestDir: {app}; Flags: external recursesubdirs<br /><br />[Code]<br />type<br />TTimerProc = procedure(HandleW, Msg, idEvent, TimeSys: LongWord);<br /><br />var<br />PercentsTimer: LongWord;<br />PercentsLabel: TLabel;<br /><br />function WrapTimerProc(callback: TTimerProc; Paramcount: Integer): longword; external 'wrapcallback@files:innocallback.dll stdcall';<br />function SetTimer(hWnd, nIDEvent, uElapse, lpTimerFunc: LongWord): longword; external 'SetTimer@user32';<br />function KillTimer(hWnd, nIDEvent: LongWord): LongWord; external 'KillTimer@user32 stdcall delayload';<br /><br />function NumToStr(Float: Extended): String;<br />Begin<br />Result:= Format('%.1n', [Float]); StringChange(Result, ',', '.');<br />while ((Result[Length(Result)] = '0') or (Result[Length(Result)] = '.')) and (Pos('.', Result) &gt; 0) do<br />SetLength(Result, Length(Result)-1);<br />end;<br /><br />procedure PercentsProc(h, msg, idevent, dwTime: Longword);<br />Begin<br />with WizardForm.ProgressGauge do<br />begin<br />PercentsLabel.Caption:= 'Выполнено ' + NumToStr((Position*100)/Max) + ' %';<br />end;<br />end;<br /><br />procedure DeinitializeSetup();<br />begin<br />KillTimer(0, PercentsTimer);<br />end;<br /><br />procedure InitializeWizard();<br />begin<br />PercentsLabel:= TLabel.Create(WizardForm);<br />with PercentsLabel do<br />begin<br />Left:= WizardForm.ProgressGauge.Left;<br />Top:= WizardForm.ProgressGauge.Top + WizardForm.ProgressGauge.Height + ScaleY(10);<br />Width:= WizardForm.StatusLabel.Width;<br />Height:= WizardForm.StatusLabel.Height;<br />AutoSize:= False;<br />Transparent := True;<br />Parent:= WizardForm.InstallingPage;<br />end;<br />end;<br /><br />procedure CurStepChanged(CurStep: TSetupStep);<br />begin<br />if CurStep = ssInstall then<br />begin<br />PercentsTimer:= SetTimer(0, 0, 100, WrapTimerProc(@PercentsProc, 4));<br />end;<br />end;
</font></blockquote><textarea id="taCode1" style="display:none;" rows="1" cols="5"></textarea><textarea id='taCode' style='display:none;' rows='1' cols='20'></textarea></code><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTM','delphi');</script>
<br /><br /><div id=heading><h1><font size=1 face=Consolas>Copyright (c) <a href=http://www.krinkels.org/ target=_blank>Krinkels Inc</a></font></h1></div></body></html>