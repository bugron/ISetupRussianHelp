<html><head><meta http-equiv=Content-Type content="text/html; charset=windows-1251"><meta name=Originator content="Microsoft Word 12"><title>Руководство по Inno Setup 5</title><o:SmartTagType namespaceuri=urn:schemas-microsoft-com:office:smarttags name="metricconverter"/><style><!--@font-face{font-family:Wingdings;panose-1:5 0 0 0 0 0 0 0 0 0;mso-font-charset:2;mso-generic-font-family:auto;mso-font-pitch:variable;mso-font-signature:0 268435456 0 0-2147483648 0;}@font-face{font-family:"Cambria Math";panose-1:2 4 5 3 5 4 6 3 2 4;mso-font-charset:1;mso-generic-font-family:roman;mso-font-format:other;mso-font-pitch:variable;mso-font-signature:0 0 0 0 0 0;}@font-face{font-family:Verdana;panose-1:2 11 6 4 3 5 4 4 2 4;mso-font-charset:204;mso-generic-font-family:swiss;mso-font-pitch:variable;mso-font-signature:-1593833729 1073750107 16 0 415 0;}@font-face{font-family:"Courier New CYR";panose-1:2 7 3 9 2 2 5 2 4 4;mso-font-charset:204;mso-generic-font-family:modern;mso-font-pitch:fixed;mso-font-signature:-536859905-1073711037 9 0 511 0;}p.MsoNormal,li.MsoNormal,div.MsoNormal{mso-style-unhide:no;mso-style-qformat:yes;mso-style-parent:"";margin:0cm;margin-bottom:.0001pt;mso-pagination:widow-orphan;font-size:12.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";}p.MsoBodyTextIndent2,li.MsoBodyTextIndent2,div.MsoBodyTextIndent2{mso-style-unhide:no;margin:0cm;margin-bottom:.0001pt;text-indent:27.0pt;mso-pagination:widow-orphan;font-size:11.0pt;mso-bidi-font-size:12.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";}a:link,span.MsoHyperlink{mso-style-unhide:no;color:blue;text-decoration:underline;text-underline:single;}a:visited,span.MsoHyperlinkFollowed{mso-style-unhide:no;color:purple;text-decoration:underline;text-underline:single;}.MsoChpDefault{mso-style-type:export-only;mso-default-props:yes;font-size:10.0pt;mso-ansi-font-size:10.0pt;mso-bidi-font-size:10.0pt;}@page WordSection1{size:595.3pt 841.9pt;margin:2.0cm 42.5pt 2.0cm 3.0cm;mso-header-margin:35.4pt;mso-footer-margin:35.4pt;mso-paper-source:0;}div.WordSection1{page:WordSection1;}@list l0{mso-list-id:28917238;mso-list-template-ids:890390648;}@list l1{mso-list-id:327753382;mso-list-type:hybrid;mso-list-template-ids:-239303958 68747279 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}@list l2{mso-list-id:1142425788;mso-list-type:hybrid;mso-list-template-ids:-805136698 68747279 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}ol{margin-bottom:0cm;}ul{margin-bottom:0cm;}--></style></head><body lang=RU link=blue vlink=purple style=tab-interval:35.4pt><div class=WordSection1><p class=MsoNormal style=mso-outline-level:1><b><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>Версия </span></b><b><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;mso-ansi-language:EN-US'>4</span></b><b><span style='font-size:
10.0pt;font-family:"Verdana","sans-serif";color:black'>.0</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal align=center style='text-align:center;mso-outline-level:
1'><b><span style=font-size:20.0pt;color:black>Руководство по </span></b><b><span lang=EN-US style=font-size:20.0pt;color:black;mso-ansi-language:EN-US>Inno</span></b><b><span lang=EN-US style=font-size:20.0pt;color:black> </span></b><b><span lang=EN-US style=font-size:20.0pt;color:black;mso-ansi-language:EN-US>Setup</span></b><b><span style=font-size:20.0pt;color:black> 5</span></b></p><p class=MsoNormal align=center style=text-align:center><b><u><span style=font-size:16.0pt;color:navy>Введение</span></u></b></p><p class=MsoNormal><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Данное руководство предназначено уже для несколько продвинутых пользователей, для тех, кто уже начал самостоятельно разбираться в коде и кому явно не хватает стандартных возможностей.</span></p><p class=MsoNormal><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Ниже будут приведены примеры только секции <b>[</b></span><b><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";mso-ansi-language:
EN-US'>Code</span></b><b><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">]</span></b><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">, но в некоторых местах по необходимости будут дописываться строки из других секций. Описания примеров будут также исключительно по необходимости.</span></p><p class=MsoNormal><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Итак, что нового в этой версии?<o:p></o:p></span></p><ol style=margin-top:0cm start=1 type=1><li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Шифровка инсталлятора от распаковщика.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Пример различных действий после удаления.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Изменение шрифта инсталлятора.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Создание страницы с выбором папки с проектами и внесением в реестр выбранного пути.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Создание серийных номеров и паролей.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Установка внешних файлов после установки основных.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Сохранение строки в </span><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
mso-ansi-language:EN-US'>host</span><span lang=EN-US style='font-size:
10.0pt;font-family:"Verdana","sans-serif"'> </span><span style='font-size:
10.0pt;font-family:"Verdana","sans-serif"'>с последующим сохранением резервной копии.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Фоновая установка кодеков и </span><span lang=EN-US style='font-size:10.0pt;
font-family:"Verdana","sans-serif";mso-ansi-language:EN-US'>DirectX</span><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Использование </span><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
mso-ansi-language:EN-US'>JPEG</span><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif"'> и </span><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";mso-ansi-language:
EN-US'>GIF</span><span lang=EN-US style='font-size:10.0pt;font-family:
"Verdana","sans-serif"'> </span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif"'>изображений в качестве фона, а также слайд-шоу во время установки.<o:p></o:p></span></li> <li class=MsoNormal style='mso-list:l2 level1 lfo3;tab-stops:list 36.0pt'><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">Исправлены некоторые неточности.<o:p></o:p></span></li></ol><p class=MsoNormal><span style=font-size:10.0pt;font-family:"Verdana","sans-serif"><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Этакая комбинированная проверка. При инициализации проверяется присутствие определенного ключа, если его нету - выдается соответствующее сообщение и на этом действия прекращаются, если ключ присутствует, то появится сообщение об удачном обнаружении программы, также проверяется присутствие уже установленной программы, с предложением ее удалить.<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=mso-ansi-language:EN-US> <b>InitializeSetup</b>(): Boolean;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp; ResultCode: Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp; s, ResultStr:<span style=color:blue>string</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>Result:=True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>Result:=True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If not</span><span lang=EN-US style=mso-ansi-language:EN-US> RegKeyExists(HKLM, 'SOFTWARE\MY_PROGRAM')<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;</span><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>begin</span></p><p class=MsoNormal>&nbsp;MsgBox('Программа <span lang=EN-US style='mso-ansi-language:
EN-US'>MY</span>_<span lang=EN-US style=mso-ansi-language:EN-US>PROGRAM</span> не установлена или установлена неверно.' #13#13 'Дальнейшая работа мастера невозможна.', mbError, mb_Ok);</p><p class=MsoNormal>&nbsp;Result:=False;</p><p class=MsoNormal><span style=color:blue>&nbsp;</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; else</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;MsgBox('</span>Программа<span lang=EN-US style=mso-ansi-language:EN-US> MY_PROGRAM </span>успешно<span style=mso-ansi-language:EN-US> </span>обнаружена<span lang=EN-US style=mso-ansi-language:EN-US>.' </span>#13#13 'Установка полностью автоматическая.', mbInformation, mb_Ok);</p><p class=MsoNormal style=tab-stops:684.0pt><span style=color:blue>&nbsp;&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp; <span style=color:blue>If</span> RegQueryStringValue(HKLM, 'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\My_Program_v1.0_is1', 'UninstallString', ResultStr)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp; <span style=color:blue>If</span> ResultStr&lt;&gt;''<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; </span><span style=color:blue>begin</span></p><p class=MsoNormal>&nbsp;&nbsp; ResultStr:=RemoveQuotes(ResultStr);</p><p class=MsoNormal>&nbsp;<span style=color:blue>&nbsp;if</span> MsgBox('Программа установки обнаружила уже установленную программу ранней версии.' #13#13 'Вы желаете предварительно удалить ее?', mbInformation, MB_YESNO) = idYes</p><p class=MsoNormal><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if not</span><span lang=EN-US style=mso-ansi-language:EN-US> Exec(ResultStr, '', '', SW_SHOWNORMAL, ewWaitUntilTerminated, ResultCode)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp; MsgBox('</span>Ошибка<span style=mso-ansi-language:EN-US> </span>удаления<span lang=EN-US style=mso-ansi-language:EN-US>. ' #13#13 '' + SysErrorMessage(ResultCode) + '.' </span>#13#13 'Вероятно, деинсталлятор был перемещен, удален или переименован.', mbError, MB_OK);</p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Вы можете проверять также присутствие определенного файла(ов) в папке с программой, либо размер, исходя из значений реестра. Просто установите нижеописанные проверки на присутствие и размер, с указанием в качестве константы данные </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:green;mso-ansi-language:EN-US>ResultStr</span></b><span style=color:green>.</span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>Многие задумывались (и я в том числе), как вставляют фоновую картинку в инсталляторах для игр?<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Оказалось так:</span> <span style=color:green>вставка внешнего изображения в фоновое окно инсталлятора:</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Setup]</span></b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>WindowVisible</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>=yes<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>;</span><span style=color:green>и</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:green>по</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>желанию</span><span style='color:black;
mso-ansi-language:EN-US'><span lang=EN-US><o:p></o:p></span></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>WindowResizable</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>=no<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Files]</span></b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\My_Image.bmp&quot;;</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> DestDir</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;{tmp}&quot;;</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: dontcopy</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>InitializeWizard</b>();</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage: TBitmapImage;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>s:</span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>string</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>;</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>ExtractTemporaryFile('My_Image.bmp'); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//My_Image.bmp - указываемое изображение в секции</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US;mso-bidi-font-weight:bold'>[Files]</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>s:=ExpandConstant('{tmp}')+'\My_Image.bmp';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage := TBitmapImage.Create(MainForm);</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage.Bitmap.LoadFromFile(s);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage.Align := alClient;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage.Parent := MainForm;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage</span><span style=color:black>.</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>Stretch</span><span style=color:black>:=</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>True</span><span style=color:black>;</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>В первой версии руководства я говорил о вызове функций из системных библиотек – можно, но описывать этот способ я не стал, т.к. вышеуказанный является самым простым, качественным и оптимальным. Но сейчас, все же о нем расскажу: если мы вставляем фоновое изображение вышеупомянутым способом, то сначала «рисуется» форма (по умолчанию синего цвета), а затем только после этого загружается в нее изображение. Получается, что нам может это «мозолить глаза». Для эстетов рекомендуется следующий вариант:</span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Setup]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>WindowVisible</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>=no<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\My_Image.bmp&quot;;</span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'> DestDir</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: &quot;{tmp}&quot;;</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: dontcopy</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> GetSystemMetrics(nIndex:Integer):Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> 'GetSystemMetrics@user32.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard</b>();<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage: TBitmapImage;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>s:</span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>string</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>width, height:Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>WizardForm.Position:=poScreenCenter;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>MainForm.BORDERSTYLE:=bsNone;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>width:=GetSystemMetrics(61); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Если</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>скрыть</span><span style='color:green;
mso-ansi-language:EN-US'> </span><span style=color:green>также</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>панель</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>задач</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>, </span><span style=color:green>то</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>значение</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US> 0 (</span><span style=color:green>см</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>. </span><span style=color:green>также</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>ниже</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>!)</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>height</span><span style=color:black>:=</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>GetSystemMetrics</span><span style=color:black>(62); </span><span style=color:green>//Если скрыть также панель задач, то значение 1</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>MainForm.Width:=width;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>MainForm.Height:=height;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>width:=MainForm.ClientWidth;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>height:=MainForm.ClientHeight;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>ExtractTemporaryFile('My_Image.bmp');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>s:=ExpandConstant('{tmp}')+'\My_Image.bmp';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage := TBitmapImage.Create(MainForm);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage.Bitmap.LoadFromFile(s);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage.Align := alClient;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage.Parent := MainForm;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>BackgroundBitmapImage.Stretch:=True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>MainForm.Visible:=True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Теперь будет загружаться изображение очень быстро и шанс заметить появление синего фона будет минимальным.<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;</span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;</span></p><p class=MsoNormal><span style=color:green>Дополнительные проверки (установка обновления).</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black> </span><b><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>NextButtonClick</span></b><span style=color:black>(</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>CurPage</span><span style=color:black>: </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>Integer</span><span style=color:black>): </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Boolean</span><span style=color:black>;</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; sz:Integer;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;&nbsp;&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; Result:=True;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPage=6</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>&nbsp;</span><span style=color:green>//Проверка присутствия определенных файлов в папке с установленной программой на странице выбора папки назначения</span></p><p class=MsoNormal><span style=color:blue>&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> (FileSearch('Main.exe', ExpandConstant('{app}'))='')</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;or</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> (FileSearch('Comp.dll', ExpandConstant('{app}')+'\data')='')</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>&nbsp; begin</span></p><p class=MsoNormal><span style=color:black>&nbsp; s:='Извините, в директории '+ExpandConstant('{app}')+'' #13 'не обнаружены файлы, подтверждающие подлинность программы.' #13#13 'Пожалуйста, выберите правильный путь для установки обновления.';</span></p><p class=MsoNormal><span style=color:black>&nbsp; MsgBox(s, mbError, mb_Ok);</span></p><p class=MsoNormal><span style=color:black>&nbsp; Result:= False</span></p><p class=MsoNormal><span style=color:blue>end</span></p><p class=MsoNormal><span style=color:blue>else</span></p><p class=MsoNormal><span style=color:green>&nbsp;//И проверка размера оригинальных файлов</span></p><p class=MsoNormal><span style=color:blue>&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> FileSize(ExpandConstant('{app}')+'\Main.exe', sz)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>&nbsp; begin</span></p><p class=MsoNormal><span style=color:blue>&nbsp;If</span><span style=color:black> sz&lt;&gt;270336 </span><span style=color:green>//Проверяемый размер в байтах</span></p><p class=MsoNormal><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>&nbsp; begin</span></p><p class=MsoNormal><span style=color:black>&nbsp; s:='Размер установленого компонента </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Main</span><span style=color:black>.</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>exe</span><span lang=EN-US style=color:black> </span><span style=color:black>не соответствует.' #13#13 'Для установки обновления требуются оригинальные файлы.';&nbsp; MsgBox(s, mbCriticalError, mb_Ok);</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Result:= False</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; end else</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> FileSize(ExpandConstant('{app}')+'\data\Comp.dll', sz)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> sz&lt;&gt;3688328</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; </span><span style=color:black>s:='Размер установленого компонента </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Comp</span><span style=color:black>.</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>dll</span><span lang=EN-US style=color:black> </span><span style=color:black>не соответствует.' #13#13 ' Для установки обновления требуются оригинальные файлы.';&nbsp; MsgBox(s, mbCriticalError, mb_Ok);</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Result:= False</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Реагирование инсталлятора на класс окна запущенного приложения. Класс окна приложения можно определить программкой</span><span style=color:black> <b>View Window </b>(</span><a href=http://sottnick.narod.ru/>http://sottnick.narod.ru/</a><span style=color:black>). </span><b style=mso-bidi-font-weight:normal><u><span style=color:green>Внимание: </span></u></b><u><span style=color:green>программка может не работать в </span></u><u><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Windows</span><span lang=EN-US style=color:green> </span></u><u><span lang=EN-US style=color:green;mso-ansi-language:EN-US>XP</span><span style=color:green> при включении «красивостей», нужно отключить все визуальные эффекты для корректной работы программки</span></u><span style=color:green>.</span></p><p class=MsoNormal><span style=color:green>Перед процессом установки программа не позволит инсталляцию файлов, если запущена «проверямая» программа (действия происходят непосредственно перед установкой).</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>NextButtonClick</b>(CurPage: Integer): Boolean;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:Longint;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; Result:=True;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPage=10</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:=FindWindowByClassName('My-Program-WINDOW'); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Указываемый</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>класс</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>окна</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US> (</span><span style=color:green>многие</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>приложения</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>могут</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>иметь</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>одинаковый</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>класс</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>!)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; </span><span style=color:blue>If</span><span style=color:black> h&lt;&gt;0 </span><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>&nbsp; begin</span></p><p class=MsoNormal><span style=color:black>&nbsp; s:='Обнаружен запущенный экземпляр программы My_Program!' #13#13'Для продолжения установки требуется закрыть его.';</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox(s, mbError, mb_Ok);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; Result:= False</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Можно закрывать программу при этом, причем повторять проверку заново. Пример</span><span style='color:green;
mso-ansi-language:EN-US'> </span><span style=color:green>закрытия</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>описывается</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>ниже</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>.</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>NextButtonClick</b>(CurPage: Integer): Boolean;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:Longint;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; Result:=True;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPage=10</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:=FindWindowByClassName('My-Program-WINDOW');</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; </span><span style=color:blue>If</span><span style=color:black> h&lt;&gt;0</span><span style=color:blue> then</span></p><p class=MsoNormal><span style=color:blue>&nbsp; begin</span></p><p class=MsoNormal><span style=color:black>&nbsp; s:='Программа установки обнаружила, что сейчас' #13'одна из копий программы My_Program выполняется.' #13#13'Сейчас она будет принудительно закрыта.';</span></p><p class=MsoNormal><span style=color:black>&nbsp; MsgBox(s, mbError, mb_Ok);</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SendMessage</span><span style=color:black>(</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>h</span><span style=color:black>, 16, 0, 0);</span><span style=color:green> //Вот это и есть закрытие программы</span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;</span><span lang=EN-US style=color:black> </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>Result:= False</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end else</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;&nbsp;&nbsp; Result := True;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>И ещё два два примера на эту тему.</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>InitializeUninstall</b>(): Boolean;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:Longint;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; Result:=True;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:=FindWindowByClassName('My-Program-WINDOW');</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; </span><span style=color:blue>If</span><span style=color:black> h&lt;&gt;0 </span><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>&nbsp; begin</span></p><p class=MsoNormal><span style=color:black>&nbsp; s:='Обнаружен запущенный экземпляр программы My_Program!' #13#13'Для запуска мастера удаления требуется закрыть его.';</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox(s, mbError, mb_Ok);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; </span><span style=color:black>Result:= False</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:green>Выход программы деинсталляции при обнаружении запущенной программы с соответствующим сообщением.</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Если пользователь всё-таки запустил ещё раз программу после сообщения: &quot;Вы действительно хотите удалить...&quot;, то деинсталлятор может закрыть её с соответствующим предупреждением.</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>CurUninstallStepChanged</b>(CurUninstallStep: TUninstallStep);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:Longint;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>case</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurUninstallStep </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>of</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; usUninstall:</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:=FindWindowByClassName('My-Program-WINDOW');</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; </span><span style=color:blue>If</span><span style=color:black> h&lt;&gt;0 </span><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>begin</span></p><p class=MsoNormal><span style=color:black>&nbsp;</span><span style=color:blue>&nbsp;If</span><span style=color:black> MsgBox('Программа удаления обнаружила, что сейчас' #13'одна из копий программы My_Program выполняется.' #13#13'Сейчас она будет принудительно закрыта.', mbError, MB_OK)=IDOK</span></p><p class=MsoNormal><span style=color:blue>then</span></p><p class=MsoNormal style=mso-outline-level:1><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SendMessage</span><span style=color:black>(</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>h</span><span style=color:black>, 16, 0, 0);<o:p></o:p></span></p><p class=MsoNormal style=mso-outline-level:1><span style=color:green>//Здесь пример закрытия одной копии программы. Если их на момент удаления выполняется несколько, допустим, то дописываем сюда соответствующее количество данного куска кода<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>case</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurUninstallStep </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>of</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; usUninstall:</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:=FindWindowByClassName('My-Program-WINDOW');</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; </span><span style=color:blue>If</span><span style=color:black> h&lt;&gt;0 </span><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>begin</span></p><p class=MsoNormal><span style=color:black>&nbsp;</span><span style=color:blue>&nbsp;If</span><span style=color:black> MsgBox('Программа удаления обнаружила, что сейчас' #13'одна из копий программы My_Program выполняется.' #13#13'Сейчас она будет принудительно закрыта.', mbError, MB_OK)=IDOK</span></p><p class=MsoNormal><span style=color:blue>then</span></p><p class=MsoNormal style=mso-outline-level:1><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SendMessage(h, 16, 0, 0);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal style=mso-outline-level:1><span style=color:green>//Относится к примеру без дополнительных фрагментов кода<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Сейчас рассмотрим следующий пример пакета обновления, и что для этого нужно.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Создание чек бокса (флажка) для возможности сохранения резервных копий файлов при установке.</span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>Это создание чек бокса и текста для одной из страниц инсталлятора, см. ниже</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; b_cb:boolean;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb:TCheckBox;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; </span><span style=color:black>StaticText: TNewStaticText;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal style=mso-outline-level:1><span style=color:green>Это процедура проверки задействования чек бокса</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>cdClick</b>(Sender: TObject);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>b_cb:=cb.CHECKED;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Это страница с выбором папки для установки. На ней помимо основных компонентов имеются еще и дополнительные. Если пользователь выбирает сохранение резервных копий, то будет создана деинсталляция, позволяюшая удалить файлы обновления, и она автоматически восстанавливает оригинальные файлы из папки </span><b><span style=color:black>Backup</span></b><span style=color:green>, попутно ее удаляя.</span></p><p class=MsoNormal><span style=color:green>Если пользователь отказался от сохранений, то какой смысл делать деинсталляцию обновления? Чтобы удалить файлы и все? Потом заново переустанавливать программу? Описание удаления деинсталляции и соответствующим к ней ключу реестра описывается ниже.</span></p><p class=MsoNormal><span style=color:blue>procedure </span><b><span style=color:black>CurPageChanged</span></b><span style=color:black>(CurPageID: Integer);</span></p><p class=MsoNormal><span style=color:blue>var</span></p><p class=MsoNormal><span style=color:green>&nbsp;//определяемые строки для сохранения резервных файлов</span></p><p class=MsoNormal><span style=color:black>&nbsp;</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s1, s2, s3, s4:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;i:Integer;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>CurPageID=wpSelectDir </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;</span><span style=color:blue>If</span><span style=color:black> cb=nil </span><span style=color:blue>then</span></p><p class=MsoNormal><span style=color:blue>&nbsp;begin</span></p><p class=MsoNormal><span style=color:green>&nbsp;//Дополнительный текст</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>StaticText := TNewStaticText.Create(WizardForm);</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; StaticText.Top :=ScaleY(185);</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; StaticText.Left :=ScaleY(40);</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; StaticText.Caption := '</span><span style=color:black>ВНИМАНИЕ</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: </span><span style=color:black>сейчас</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>оригинальные</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:black>файлы</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:black>программы</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:black>будут</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:black>обновлены</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>.' </span><span style=color:black>#13 'Рекомендуется сохранить их резервные копии.' #13#13#13 'Если вы откажетесь от сохранения резервных копий, деинсталляции не будет.' #13 'При сохранении можно восстановить оригинальные файлы после удаления.';</span></p><p class=MsoNormal><span style=color:black>&nbsp; StaticText.AutoSize := True;</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>StaticText.Parent :=WizardForm;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; StaticText.Font.Color := clRed;</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>&nbsp;</span><span style=color:green>//Чек бокс для сохранения резервных копий</span></p><p class=MsoNormal><span style=color:black>&nbsp; </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>cb:=TCheckBox.Create(WizardForm);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb.Parent:=WizardForm;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb.Width:=ScaleX(220);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb.Left:=ScaleY(40);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb.Top:=ScaleY(215);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb.CAPTION:='</span><span style=color:black>Сохранить</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:black>резервные</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:black>копии</span><span style=color:black;mso-ansi-language:EN-US> </span><span style=color:black>файлов</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb.ONCLICK:=@cdClick;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;end</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>else</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> cb&lt;&gt;nil </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb.Free;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; cb:=nil;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;&nbsp; If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> StaticText&lt;&gt;nil </span><span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; StaticText.Free;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; StaticText:=nil;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>CurPageID=wpInstalling </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>begin</span></p><p class=MsoNormal><span style=color:green>//Если чек бокс был отмечен, то в результате установки произойдет сохранение резервных копий указанных файлов</span></p><p class=MsoNormal><span style=color:blue>&nbsp;</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> b_cb </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s1:=ExpandConstant('{app}')+'\Main.exe';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s2:=ExpandConstant('{app}')+'\Backup';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> FileExists(s1)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;CreateDir(s2);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;FileCopy(s1, s2+'\Main.exe', True);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s3:=ExpandConstant('{app}')+'\data\Comp.dll';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s4:=ExpandConstant('{app}')+'\Backup\data';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> FileExists(s3) </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;CreateDir(s4);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;FileCopy(s3, s4+'\Comp.dll', True);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Удаление папки с файлами деинсталлятора и соответствующей записи в реестре, если пользователь отказался от сохранения резервных копий. Смысл такой: если инсталлятор видит папку </span><b><span style=color:black>Backup</span></b><span style=color:green>, то деинсталлятор и соответствующая запись реестра не будут удалены, т.к. пользователь выбрал сохранение резервных копий, а если инсталлятор не видит этой папки, то он удалит указанную папку </span><b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Update</span><span style=color:black>_Uninstall</span></b><span style=color:green> с файлами деинсталлятора и соответствующей записью реестра. Выполнение процедуры происходит сразу после выполнения установочных действий. (Папку с файлами деинсталляции создаем таким образом: </span><b><span style=color:black>[</span></b><b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Setup</span><span style=color:black>]</span></b><span style=color:green> =&gt; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>UninstallFilesDir</span><span style=color:black>={</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>app</span><span style=color:black>}\</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Update</span><span style=color:black>_</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>Uninstall</span><span style=color:green>)<o:p></o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>CurStepChanged</b>(CurStep: TSetupStep);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s3:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurStep=ssPostInstall</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s3:=ExpandConstant('{app}')+'\Backup';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If not</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> DirExists(s3)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>DelTree(ExpandConstant('{app}')+'\Update_Uninstall', True, True, True);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>RegDeleteKeyIncludingSubkeys(HKLM, 'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\My_Program_Update_is1')</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:green>Вообще, по содержимому данного ключа, если он присутствует, инсталлятор при инициализации предложит удалить уже установленное обновление (только в том случае, если пользователь ранее установил его и выбрал сохранение резервных копий). Но когда деинсталлятор (при отмене сохранения резервных копий) удаляется, то и ключ этот не нужен, т.к. чтобы не было проверки на уже установленное обновление, которое инсталлятор предложит удалить при инициализации (если вы используете соответствующую проверку).</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Деинсталляция - после выполнения операций оригинальные файлы восстанавливаются,</span></p><p class=MsoNormal><span style=color:green>а папка с резервными файлами удаляется.</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>CurUninstallStepChanged</b>(CurUninstallStep: TUninstallStep);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s1, s2, s3, s4:</span><span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; case</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurUninstallStep </span><span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'>of</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;&nbsp;&nbsp; usPostUninstall:</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s1:=ExpandConstant('{app}')+'\Backup\Main.exe';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s2:=ExpandConstant('{app}');</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> FileExists(s1)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;CreateDir(s2);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;FileCopy(s1, s2+'\Main.exe', True);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s3:=ExpandConstant('{app}')+'\Backup\data\Comp.dll';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s4:=ExpandConstant('{app}')+'\data';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> FileExists(s1)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;CreateDir(s4);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;FileCopy(s3, s4+'\Comp.dll', True);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox('Оригинальные файлы программы успешно восстановлены.', mbInformation, MB_OK);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s1:=ExpandConstant('{app}')+'\Backup';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>DirExists(s1)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>DelTree(ExpandConstant('{app}')+'\Backup', True, True, True);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox('Папка с резервными файлами полностью удалена.', mbInformation, MB_OK);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>ВНИМАНИЕ!!! Функция </span><b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>DelTree</span></b><span style=color:green> одна из самых опасных! Например, если вы создали инсталлятор и в деинсталлятор поставили эту функцию на полное удаление каталога,</span></p><p class=MsoNormal><span style=color:green>например: полное удаление папки с программой, то если вдруг вы установите программу на диск С (например), то после удаления программы вам придётся переустанавливать винду, потому что деинсталлятор начнет беспощадно удалять все файлы из директории, куда была установлена программа (проверено на личном опыте</span><span lang=EN-US style=font-family:Wingdings;color:green;mso-ansi-language:EN-US>J</span><span style=color:green>).</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Извлечение (и запуск) программы при инициализации во временную папку, с закрытием запущенной внешней программы через определяемый класс окна после завершения работы мастера.</span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Files]</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal style=mso-outline-level:1><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\Temp_Program.exe&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>DestDir</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;{tmp}&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: dontcopy</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>;Ещё один или несколько файлов указываются аналогично.<o:p></o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Code]</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>InitializeSetup</b>(): Boolean;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; res:Integer;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s, ResultStr:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp;</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; ExtractTemporaryFile('Temp_Program.exe'); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Извлечение</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>и</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>запуск</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US> &quot;</span><span style=color:green>временной</span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>&quot;&nbsp;</span><span style=color:green>программы</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>. </span><span style=color:green>Чтобы указать извлечение нескольких файлов, следует дописать такую же &nbsp;строку, но уже с другим определяемым файлом.</span></p><p class=MsoNormal><span style=color:green>&nbsp; </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Дописать</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>здесь</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>:)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; s:=ExpandConstant('{tmp}')+'\Temp_Program.exe';</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; Exec(s, '', '', SW_SHOWNORMAL, ewNoWait, res); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Запуск</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>приложения</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; Result</span><span style=color:black>:=</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>True</span><span style=color:black>;</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Чтобы инсталлятор после завершения работы автоматически закрывал запущенную из временной папки программу, следует написать следующее. Процедура закрывает программу и, используя функцию </span><b><span style=color:black>Sleep</span></b><span style=color:green>, позволяет вовремя выгрузить файлы из временной директории (опять же через класс окна).</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>DeInitializeSetup</b>();</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:Longint;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; h:=FindWindowByClassName('Temp-Program-WINDOW');</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp; If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> h&lt;&gt;0</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; SendMessage(h, 16, 0, 0);</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>&nbsp;</span><span style=color:blue>begin</span></p><p class=MsoNormal><span style=color:black>&nbsp; Sleep(100); </span><span style=color:green>//Без этой функции временные файлы не смогут удалиться из-за нехватки времени для выгрузки, значение указывается в миллисекундах. Время для задержки определяется в зависимости от размера временных файлов.</span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Многие хотят и не могут убрать страницу приветствия, потому что она по умолчанию не отключается, но это ерунда.</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>CurPageChanged</b>(CurPageID: Integer);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpWelcome </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SendMessage(WizardForm.NEXTBUTTON.Handle, 513, 0, 0)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SendMessage(WizardForm.NEXTBUTTON.Handle, 514, 0, 0)</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Также можно отключить какую-нибудь кнопку, вот пример отключения кнопки «Назад» на странице принятия Лицензионного Соглашения.</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b>CurPageChanged</b>(CurPageID: Integer);</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpLicense </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; WizardForm.BackButton.Enabled := False;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>else</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpInfoBefore</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> then</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&nbsp; WizardForm.BackButton.Enabled := True;</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;</span></p><p class=MsoNormal><span style=color:green>Также включение отключение кнопок может быть задействовано исходя из значений реестра (но это уже сами).</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style=color:green>Теперь приведу примеры создания двух различных типов установок компонента русификации для игровых инсталляторов (есть и третий тип, он стандартный, с окошком и описываться не будет).</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Files]</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Components:</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> rus; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source:</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> &quot;C:\Rus\*&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>DestDir:</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> &quot;{app}&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: ignoreversion recursesubdirs createallsubdirs</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>;В папке </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Rus</span><span style=color:green> должны находиться русифицированные файлы.</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal style=mso-outline-level:1><span style=color:green>Выпадающий</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>список</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Components]</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal style=mso-outline-level:1><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;eng&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Английская</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>версия</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Types</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: eng</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;rus&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Русская</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>версия</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Types</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: rus</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;<o:p></o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Types]</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;rus&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Русская</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>версия</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&quot;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;eng&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Английская</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>версия</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&quot;</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;<o:p></o:p></span></p><p class=MsoNormal style=mso-outline-level:1><span style=color:green>Кнопки</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>переключения</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Components]</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal style=mso-outline-level:1><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;eng&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Английская</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>версия</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&quot;;&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: exclusive</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;rus&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Русская</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>версия</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&quot;;&nbsp; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: exclusive</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;<o:p></o:p></span></p><p class=MsoNormal><b><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>[Types]</span></b><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;custom&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Выборочная</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>установка</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: iscustom</span><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>&nbsp;<o:p></o:p></span></p><p class=MsoNormal style=mso-outline-level:1><span style=color:green>Для ленивых:). Также в играх:<o:p></o:p></span></p><p class=MsoNormal><b><span style=color:black>[</span></b><b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Setup</span><span style=color:black>]<o:p></o:p></span></b></p><p class=MsoNormal><span style=color:green;mso-bidi-font-weight:bold>;Разбиение на диски<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>DiskSpanning</span>=<span lang=EN-US style=mso-ansi-language:EN-US>yes</span></p><p class=MsoNormal><span style=color:green;mso-bidi-font-weight:bold>;Размер тома в байтах (здесь 695 мегабайт, уменьшите значение, если вы записываете меню автозапуска)</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>DiskSliceSize</span>=730000000</p><p class=MsoNormal style=mso-outline-level:1><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style=text-align:center><b style='mso-bidi-font-weight:
normal'><u><span style=font-size:14.0pt;color:green>Нововведения версии 2.0<o:p></o:p></span></u></b></p><p class=MsoNormal align=center style=text-align:center><b style='mso-bidi-font-weight:
normal'><u><span style=font-size:14.0pt;color:green><o:p><span style=text-decoration:none>&nbsp;</span></o:p></span></u></b></p><p class=MsoNormal><span style=color:green>Чтобы заставить инсталлятор при нажатии на кнопку «Отмена» выдавать<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>собственное сообщение, следует написать следующую процедуру:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CancelButtonClick</b>(CurPage: Integer; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> Cancel, Confirm: Boolean);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>Cancel:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>Confirm:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if</span><span lang=EN-US style=color:blue> </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>MsgBox</span><span style=color:black>('Вы действительно хотите отменить установку </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>My</span><span style=color:black>_</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Program</span><span style=color:black>?', </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>mbError</span><span style=color:black>, </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MB</span><span style=color:black>_</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>YESNO</span><span style=color:black>) = </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>idYes</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>then</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Cancel</span><span style=color:black>:=</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>true</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Чтобы убрать пункт контекстного меню «О программе» при нажатии правой кнопкой мыши<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>на панели заголовка инсталлятора пишем такую строчку в процедуре инициализации мастера:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US> </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>InitializeWizard()</span></b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.Position:=poScreenCenter;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Чтобы назначить собственный текст кнопок страниц мастера пишем следующую процедуру.<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurPageChanged</b>(CurPageID: Integer);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>CurPageID=wpWelcome </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> WizardForm.FindComponent('NextButton') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>is</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> TButton<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>TButton(WizardForm.FindComponent('NextButton')).Caption:='Вперед &gt;&gt;&gt;';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> WizardForm.FindComponent('CancelButton') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>is</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> TButton<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>TButton(WizardForm.FindComponent('CancelButton')).Caption:='Выход';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Изменение размера страницы с индикатором выполнения установки с последующим перемещением ее в угол экрана (например, это имеет значение в игровом инсталляторе, когда вставлено фоновое изображение, и мы хотим видеть основное его содержимое полным и заодно наблюдать за ходом установки).<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>procedure</span><span style=color:black> <b style=mso-bidi-font-weight:normal>InitializeWizard</b>();<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>begin<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes> </span></span><span style=color:green>//Выносим кнопку &quot;Отмена&quot; на передний план<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.CancelButton.BringToFront;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurPageChanged</b>(CurPageID: Integer);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>if </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>CurPageID=wpInstalling<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.MainPanel.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.Bevel1.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.Width:=ScaleX(395);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.Height:=ScaleY(142);<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//Здесь смещение страницы установки (в верхний левый угол)<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.Left:=ScaleX(0);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.Top:=ScaleY(0);<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>{Внимание! Нижеописанные способы смещения работают только когда вставлено фоновое изображение или </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>WindowVisible</span><span style=color:green>=</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>yes</span><span style=color:green>}</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>{Выводит в правом верхнем углу экрана}<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//WizardForm.Left:=ScaleX(MainForm.Width-420);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//WizardForm.Top:=ScaleY(MainForm.Left+20);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>{Выводит снизу по центру экрана}<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//WizardForm.Position:=poScreenCenter;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//WizardForm.Top:=ScaleY(MainForm.Height-170);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>{</span><span style=color:green>Выводит</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>в</span><span style='color:green;
mso-ansi-language:EN-US'> </span><span style=color:green>нижнем</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>левом</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>углу</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US> (</span><span style=color:green>как</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>в</span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'> Doom 3 Resurrection of Evil </span><span style=color:green>от</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'> <st1:metricconverter ProductID=1C w:st=on>1C</st1:metricconverter>)} <br> //WizardForm.Left:=ScaleX(MainForm.Left+20); <br> //WizardForm.Top:=ScaleY(MainForm.Height-170);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>{</span><span style=color:green>Выводит</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>в</span><span style='color:green;
mso-ansi-language:EN-US'> </span><span style=color:green>нижнем</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>правом</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>углу</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>} <br> //WizardForm.Left:=ScaleX(MainForm.Width-420); <br> //WizardForm.Top:=ScaleY(MainForm.Height-170);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.InnerNotebook.Left:=ScaleX(10);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.InnerNotebook.Top:=ScaleY(10);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.InnerNotebook.Width:=ScaleX(370);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.StatusLabel.Left:=ScaleX(0);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.StatusLabel.Top:=ScaleY(0);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.StatusLabel.Width:=WizardForm.InnerNotebook.Width;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.FileNameLabel.Left:=ScaleX(0);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.FileNameLabel.Top:=ScaleY(20);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.FileNameLabel.Width:=WizardForm.InnerNotebook.Width;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.ProgressGauge.Top:=ScaleY(40);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.ProgressGauge.Width:=WizardForm.InnerNotebook.Width;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.CancelButton.Left:=ScaleX(154);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.CancelButton.Top:=ScaleY(80);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>end<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpFinished<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>then</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span></span><span style=color:black>WizardForm.Width:=502;</span><span style=color:green>{Размер окна по горизонтали}</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span>WizardForm.Height:=392;</span><span style=color:green>{Размер окна по вертикали}</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span>WizardForm.Position:=poScreenCenter; </span><span style=color:green>{Возврат в исходное состояние}</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes> </span>end<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Чтобы изменить текст в свойствах инсталлятора «Комментарий» и изменить «Язык» с «Английский» на «Русский», требуется программа </span><b style=mso-bidi-font-weight:normal><i style=mso-bidi-font-style:normal><span lang=EN-US style='color:#FF6600;
mso-ansi-language:EN-US'>Resource</span><span lang=EN-US style=color:#FF6600> </span></i></b><b style=mso-bidi-font-weight:normal><i style='mso-bidi-font-style:
normal'><span lang=EN-US style=color:#FF6600;mso-ansi-language:EN-US>Hacker</span></i><span lang=EN-US style=color:green> </span></b><span style=color:black>(</span><a href=http://rpi.net.au/~ajohnson/resourcehacker>http://rpi.net.au/~ajohnson/resourcehacker</a><span style=color:black>).</span><b style=mso-bidi-font-weight:normal><span style=color:green> </span></b><span style=color:green>Скачиваем программу, открываем ею файл <u>SetupLdr.e32</u><span style=mso-spacerun:yes>  </span>в папке с программой </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>Inno</span><span lang=EN-US style=color:green> </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Setup</span><span style=color:green>. Открываем ресурс «</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Version</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>Info</span><span style=color:green>» и в поле </span><span style='font-size:10.0pt;font-family:"Courier New"'>&quot;Comments&quot; </span><span style=color:green>осуществляем собственный перевод, а чтобы в свойствах инсталлятор отображал «Русский» вместо «Английского» языка, пишем в поле </span><span style='font-size:10.0pt;font-family:"Courier New"'>&quot;Translation&quot; </span><span style=color:green>вместо </span><span style='font-size:10.0pt;font-family:
"Courier New"'>0x0409 0x04E4 </span><span style=color:green>вот это: </span><span style='font-size:10.0pt;font-family:"Courier New"'>0x0419 0x04E3</span><span style=color:green>. Далее сохраняем изменения и вуаля! Также можно сделать свой перевод свойств Деинсталлятора (файл <u>Setup.e32</u> ). Изменение остальных полей не рекомендуется, т.к. их можно задать в сценарии.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Привожу пример использования класса</span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:green'> <b style=mso-bidi-font-weight:normal>Notebook</b>.<b style=mso-bidi-font-weight:normal> </b></span><span style=color:green>С помощью применения данного класса можно серьезно изменить внешний вид инсталлятора. </span><span style=color:red>Для корректной работы вставьте файл лицензионного соглашения</span><span style=color:green>:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal>[</b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='mso-ansi-language:
EN-US'>Setup</span>]</b><br> <span lang=EN-US style=color:blue;mso-ansi-language:EN-US>LicenseFile</span>=<span lang=EN-US style=mso-ansi-language:EN-US>license</span>.<span lang=EN-US style=mso-ansi-language:EN-US>rtf</span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Messages</span><span style=color:black>]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>LicenseLabel</span><span style=color:black>3=Чтобы продолжить установку, вы должны принять условия этого соглашения. Если вы принимаете эти условия, нажмите «Согласен», чтобы продолжить. Если вы не согласны с условиями соглашения, нажмите «Нет», чтобы выйти из программы установки.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Code]</span></b><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";color:green;
mso-ansi-language:EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard()</b>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>Page: TWizardPage;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>StaticText: TNewStaticText;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.WizardSmallBitmapImage.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.OuterNotebook.Height:=WizardForm.ClientHeight;</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>{Здесь компонент OuterNotebook растягивается на всю высоту окна инсталлятора}</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.Bevel.BringToFront;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.BackButton.BringToFront;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.NextButton.BringToFront;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.CancelButton.BringToFront;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.WelcomeLabel1.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.WelcomeLabel2.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.WizardBitmapImage.Width:=WizardForm.ClientWidth;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.WizardBitmapImage.Height:=WizardForm.ClientHeight;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.WizardBitmapImage2.Width:=WizardForm.ClientWidth;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.WizardBitmapImage2.Height:=WizardForm.ClientHeight;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.FinishedHeadingLabel.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.FinishedLabel.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Page:=PageFromID(wpLicense);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>StaticText:=TNewStaticText.Create(Page);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>StaticText.Top:=0;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>StaticText.Caption:='Для перемещения по тексту используйте клавиши «PageUp/PageDown».';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>StaticText.Parent:=Page.Surface;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.LicenseMemo.Color:=clRed;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.LicenseLabel1.Align:=alBottom;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.LicenseAcceptedRadio.Checked:=True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.LicenseAcceptedRadio.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.LicenseNotAcceptedRadio.Visible:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.LicenseMemo.Top:=18;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.LicenseMemo.Height:=162;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurPageChanged(CurPageID: Integer)</b>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpWelcome </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> WizardForm.FindComponent('OuterNotebook') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>is</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> TNewNotebook </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>TNewNotebook(WizardForm.FindComponent('OuterNotebook')).Height:=WizardForm.ClientWidth;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>end<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpLicense</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> WizardForm.FindComponent('NextButton') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>is</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> TButton </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>TButton(WizardForm.FindComponent('NextButton')).Caption:='Согласен';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> WizardForm.FindComponent('CancelButton') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>is</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> TButton </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>TButton(WizardForm.FindComponent('CancelButton')).Caption:='Нет';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> WizardForm.FindComponent('OuterNotebook') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>is</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> TNewNotebook </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>TNewNotebook(WizardForm.FindComponent('OuterNotebook')).Height:=ScaleY(313);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>WizardForm.InnerPage.Color :=clYellow;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>end<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpFinished</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> WizardForm.FindComponent('OuterNotebook') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>is</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> TNewNotebook</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>TNewNotebook(WizardForm.FindComponent('OuterNotebook')).Height:=WizardForm.ClientWidth;</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>{То же самое, только на финишной странице}</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>end</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:blue>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Можно изменять размеры и цвет компонентов страниц мастера, смещать их и т.д. Ознакомьтесь с применениями всех доступных классов в главе</span><span style=color:black> <b style='mso-bidi-font-weight:
normal'>Pascal Scripting: Support Classes Reference</b></span><span style=color:green>.</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style=text-align:center><b style='mso-bidi-font-weight:
normal'><u><span style=font-size:14.0pt;color:green>Нововведения версии 3.0<o:p></o:p></span></u></b></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Зачастую, создавая инсталлятор для той или иной программы либо игры, мы сталкиваемся с тем, что необходимо внести определенные данные в реестр для того, чтобы программа/игра корректно работала и запускалась. Для начала необходимо разобраться, какие данные нам нужны. Определяется это довольно просто. Нам нужен сканер реестра и добавляемых в систему новых файлов. Лично я использую программку </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:fuchsia;mso-ansi-language:EN-US>Regshoot</span><span lang=EN-US style=color:fuchsia> </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:fuchsia;mso-ansi-language:EN-US>v</span><span style=color:fuchsia>1.7.2 </span></b><span style=color:green>(</span><a href=http://regshot.yeah.net/><span lang=EN-US style=mso-ansi-language:EN-US>http</span>://<span lang=EN-US style=mso-ansi-language:EN-US>regshot</span>.<span lang=EN-US style=mso-ansi-language:EN-US>yeah</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>net</span></a><span style=color:green>, </span><a href=http://regshot.isd.md/>http://regshot.isd.md</a><span style=color:green>, </span><a href=http://www.digitalnuke.com/>http://www.digitalnuke.com</a><span style=color:green>). Следует немного описать работу программы. Данный сканер делает снимки реестра «До» и «После» внесения данных в реестр, а также умеет делать снимок всех добавляемых в систему файлов (а также их изменение, например, перезапись). Например, мы, допустим, знаем, что программа устанавливается только в свою папку и не копирует файлы в папку </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Common</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Files</span><span style=color:green>, но мы не знаем, какие точно файлы устанавливаются в папку </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>WINDOWS</span><span style=color:green>, т.е. могут устанавливаться драйвера, шрифты, системные файлы, </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>INI</span><span lang=EN-US style=color:green> </span><span style=color:green>файлы и др. Мы сначала делаем первый снимок, но предварительно отметив ту директорию, которую мы хотим просканировать, в нашем случае это вся папка </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>WINDOWS</span><span style=color:green>. Затем устанавливаем программу, и после установки делаем второй снимок. Далее сравниваем снимки и получаем подробный отчет обо всех изменениях. ВАЖНО!!! Следует проделывать данную операцию на «чистой» системе, в которой не была ни разу установлена программа. Все очень просто, если мы устанавливаем ее еще раз, то инсталлятор может проигнорировать внесение важных данных в реестр и установку определенных файлов, и мы соответственно получим не все данные и создадим некачественный инсталлятор. Лично у меня установлена вторая ОС для таких дел.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>После снимка может быть много мусора, который вовсе нам и не надо. Следует научиться различать, какие файлы и данные реестра действительно принадлежат программе.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Итак, следует отметить (многие могут со мной не согласиться), что для вносимых инсталлятором данных в реестре только две наиболее важные ветки, это: </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>CURRENT</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>USER</span><span lang=EN-US style=color:green> </span></b><span style=color:green>и </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>LOCAL</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>MACHINE</span></b><span style=color:#339966>.</span><span style=color:green><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Сейчас буду объяснять, что к чему. Сканируя сканером </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:fuchsia;mso-ansi-language:EN-US>Regshoot</span></b><span style=color:green>,</span><b style=mso-bidi-font-weight:normal><span style=color:fuchsia> </span></b><span style=color:green>вы не увидите в нем ветки </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>CURRENT</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>USER</span></b><span style=color:green>, вместо нее, например, </span><b style=mso-bidi-font-weight:normal><span style='color:
blue'>HKEY_USERS\S-1-5-21-725345543-1715567821-839522115-1003\Software</span></b><span style=color:green>_и т.д. Следует учесть, что это ветка</span><span style=color:#339966> </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>CURRENT</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>USER</span><span style=color:blue>\Software</span></b><span style=color:green>_и т.д.<b style=mso-bidi-font-weight:normal> </b>и инсталлятору нужно указывать прописывать данные именно в эту ветку. В ветке </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>CLASSES</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ROOT</span><span lang=EN-US style=color:blue> </span></b><span style=color:green>и</span><b style=mso-bidi-font-weight:normal><span style=color:blue> </span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>LOCAL</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>MACHINE</span><span style=color:blue>\</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>SOFTWARE</span><span style=color:blue>\</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Classes</span><span lang=EN-US style=color:blue> </span></b><span style=color:green>хранятся типы зарегистрированных классов, расширений, регистрация компонентов и т.д. Данные, внесенные в ветку</span><span style=color:#339966> </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>LOCAL</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>MACHINE</span><span style=color:blue>\</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>SOFTWARE</span><span style=color:blue>\</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Classes</span></b><span lang=EN-US style=color:#339966> </span><span style=color:#339966>автоматически копируются в ветку </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>HKEY</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>CLASSES</span><span style=color:blue>_</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ROOT</span><span lang=EN-US style=color:blue> </span></b><span style=color:green>и наоборот.</span><span style=color:#339966><o:p></o:p></span></p><p class=MsoNormal><span style=color:#339966><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Итак, приступим непосредственно к самим внесениям данных.</span><span style=color:#339966><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>К данным с фигурными скобками, например,</span><span style=color:#339966> </span>{88<span lang=EN-US style=mso-ansi-language:EN-US>d</span>969c1-f192-11d4-a65f-0040963251e5}<span style=color:green> следует дописывать в начало еще одну скобку, иначе данные будут восприняты инсталлятором как неизвестная константа. Например</span><span style=color:#339966>: </span>{{<span style=color:black>88</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>d</span><span style=color:black>969</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>c</span><span style=color:black>1-</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>f</span><span style=color:black>192-11</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>d</span><span style=color:black>4-</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>a</span><span style=color:black>65</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>f</span><span style=color:black>-0040963251</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>e</span><span style=color:black>5}</span><span style=color:green>.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Иногда попадаются такие данные в параметре, например: </span><span style=color:black>&quot;C:\Program Files\Passolo 5\psl_u.exe&quot; &quot;%1&quot;</span><span style=color:green>. «Ну и как их внести?» - спросите вы. А очень просто, следует писать так:</span><span style=color:#339966><o:p></o:p></span></p><p class=MsoNormal><span style=color:black>&quot;{</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>app</span><span style=color:black>}\</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>psl</span><span style=color:black>_</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>u</span><span style=color:black>.</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>exe</span><span style=color:black> &quot;&quot;%1&quot;&quot;&quot; </span><span style=color:green>(Отметьте, что сама константа здесь написана просто как пример, важна правильная расстановка кавычек.) С внесением остальных данных, думаю, проблем быть не должно, читайте справку для подробного ознакомления.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Еще дам небольшую подсказку. Например, программа использует собственный активный элемент (</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>ActiveX</span><span style=color:green>). Зачастую имеющий расширение </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>OCX</span><span style=color:green> или </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>DLL</span><span style=color:green>. Мы знаем, что данный элемент будет активно работать с реестром и нам нужно «выдрать» из него всю его регистрацию. Самый простой и нужный вариант</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\SYSTEM\msxml4.dll&quot;; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>DestDir</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: &quot;{sys}&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: restartreplace sharedfile regserver<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Ранее я допускал конкретную ошибку – добавлял флаг </span><span style=color:black>regtypelib</span><span style=color:green>, из-за чего полноценная регистрация компонента не выполнялась, и все данные приходилось вносить вручную. Для полной регистрации (внесения всех данных активного элемента в реестр) нужен только флаг </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>regserver</span><span style=color:green>!<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Чтобы узнать, активный элемент или нет, советую использовать программу</span><span style=color:#339966> </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:red;
mso-ansi-language:EN-US'>PE</span><span lang=EN-US style=color:red> </span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:red;
mso-ansi-language:EN-US'>Explorer</span><span lang=EN-US style=color:red> </span></b><span style=color:black>(</span><a href=http://www.heaventools.com/>http://www.heaventools.com</a><span style=color:black>). </span><span style=color:green>В ней можно открыть этот активный элемент и посмотреть необходимые данные в ресурсах </span><b style=mso-bidi-font-weight:normal><span style=color:blue>TypeLib</span><span style=color:green> </span></b><span style=color:green>и</span><b style=mso-bidi-font-weight:normal><span style=color:blue> </span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>REGINST</span><span style=color:blue>\</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>REGISTRY</span><span lang=EN-US style=color:blue> </span></b><span style=color:green>и т.д., если таковые имеются. Также </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Inno</span><span lang=EN-US style=color:green> </span><span style=color:green>выдаст ошибку, если регистрация компонента не состоится.</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Теперь опишу пример связывания устанавливаемой программы с желаемыми типами файлов. В том же </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:red;
mso-ansi-language:EN-US'>PE</span><span lang=EN-US style=color:red> </span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:red;
mso-ansi-language:EN-US'>Explorer</span><span style=color:green>, </span></b><span style=color:green>например, ассоциируем программу с файлами, имеющими расширение </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>EXE</span><span style=color:green>:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[Tasks]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span style=color:black>: &quot;</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>sendto</span><span style=color:black>&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span><span style=color:black>: &quot;Добавить </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>PE</span><span lang=EN-US style=color:black> </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Explorer</span><span lang=EN-US style=color:black> </span><span style=color:black>в &amp;контекстное меню&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>GroupDescription</span><span style=color:black>: &quot;Интеграция в оболочку:&quot;;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Registry]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Root</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: HKCR; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Subkey</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;exefile\shell\Open_with_PE_Explorer&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueType</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: String; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueData</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;</span><span style=color:black>Открыть</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>в</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> PE Explorer&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Tasks</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;sendto&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: uninsdeletekey<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Root</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: HKCR; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Subkey</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;exefile\shell\Open_with_PE_Explorer\command&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueType</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: String; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueData</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;&quot;&quot;{app}\pexplorer.exe&quot;&quot; &quot;&quot;%1&quot;&quot;&quot;; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Tasks</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: &quot;sendto&quot;;</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>;</span><span style=color:green>или</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>так</span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'> (</span><span style=color:green>рекомендуется</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Root</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: HKLM; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Subkey</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;SOFTWARE\Classes\exefile\Shell\Open_with_PE_Explorer&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueType</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: string; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueName</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueData</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;O</span><span style=color:black>ткрыть</span><span style='color:black;mso-ansi-language:
EN-US'> </span><span style=color:black>в</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> PE Explorer&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Tasks</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;sendto&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: uninsdeletekey<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Root</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: HKLM; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Subkey</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;SOFTWARE\Classes\exefile\Shell\Open_with_PE_Explorer\command&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueTyp</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>e: string; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueName</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueData</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;{app}\pexplorer.exe &quot;&quot;%1&quot;&quot;&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Tasks</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;sendto&quot;;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Кавычки расставлены по-разному просто как дополнительный вариант.</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:#339966><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:#339966><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Сейчас рассмотрим пример автоматического запуска самораспаковывающегося архива 7</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>z</span><span style=color:green>.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>SFX</span><span style=color:green>. «Для чего он?» - спросите вы. Дело в том, что когда мы, например, записываем </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>CD</span><span style=color:green>-</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>R</span><span style=color:green> диски с игрой, то нам может не хватить места для записи </span><b style=mso-bidi-font-weight:normal><i style=mso-bidi-font-style:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>DirectX</span></i></b><span style=color:green>, либо будет получаться остаток в несколько десятков мегабайт для следующего тома.<span style=mso-spacerun:yes>   </span>Максимальный метод сжатия</span><span style=color:#339966> </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>lzma</span><span style=color:blue>/</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ultra</span><span lang=EN-US style=color:blue> </span><span style=color:green>может не обеспечить требуемого сжатия. Не скажу, что данный метод плохо жмет, просто архиватор 7</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>z</span><span style=color:green> жмет немножко лучше и особенно это видно при записи многодисковых игр. Итак, в архиваторе</span><span style=color:#339966> </span><b style=mso-bidi-font-weight:normal><span style=color:#3366FF>7-</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:#3366FF;
mso-ansi-language:EN-US'>Zip</span></b><span style=color:#339966> (</span><a href=http://www.7-zip.org/><span lang=EN-US style=mso-ansi-language:EN-US>http</span>://<span lang=EN-US style=mso-ansi-language:EN-US>www</span>.7-<span lang=EN-US style=mso-ansi-language:EN-US>zip</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>org</span></a><span style=color:#339966>) </span><span style=color:green>создаем обычный </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>SFX</span></b><span style=color:green> архив, установив метод сжатия</span><span style=color:#339966> </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>lzma</span><span style=color:black>/</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>ultra</span><span lang=EN-US style=color:#339966> </span><span style=color:green>и формат</span><span style=color:#339966> </span><span style=color:black>7</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>z</span><span style=color:#339966>, </span><span style=color:green>отметив галочку</span><span style=color:#339966> </span><span style=color:black>«Создать </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Solid</span><span style=color:black> архив»</span><span style=color:#339966>.<o:p></o:p></span></p><p class=MsoNormal><span style=color:#339966><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Сначала мы устанавливаем архив, затем он автоматически распаковывается, а после завершения своей работы удаляется:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\NVIDIA.exe&quot;; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>DestDir</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: &quot;{app}&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: deleteafterinstall nocompression<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Run]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Filename</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;{app}\NVIDIA.exe&quot;; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Parameters</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: &quot;-y&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: waituntilterminated hidewizard<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Устанавливая флаг</span><span style=color:#339966> </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>deleteafterinstall</span><span style=color:green> в секции </span><b style=mso-bidi-font-weight:normal><span style=color:black>[</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>Files</span><span style=color:black>] </span></b><span style=color:green>мы заставляем архив удалиться после установки и выполнения, а также мы устанавливаем флаг<span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>nocompression</span><span lang=EN-US style=color:#339966> </span><span style=color:green>для того, чтобы инсталлятор бессмысленно не сжимал архив. При запуске устанавливаем параметр </span><span style=color:black>–</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>y</span><span style=color:green>, который обозначает «Всегда Да» при любых действиях. Флаг </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>waituntilterminated</span><span lang=EN-US style=color:black> </span><span style=color:green>должен быть всегда в этом случае. При желании можно установить дополнительные флаги, например,</span><span style=color:#339966> </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>hidewizard</span><span lang=EN-US style=color:black> </span><span style=color:green>скрывает окно инсталлятора при выполнении распаковки архива. Саму оболочку архива можно перевести самому. Откройте упомянутой программой </span><b style='mso-bidi-font-weight:
normal'><i style=mso-bidi-font-style:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Resource</span><span lang=EN-US style=color:green> </span></i></b><b style=mso-bidi-font-weight:normal><i style=mso-bidi-font-style:normal><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Hacker</span></i></b><span style=color:green> файл 7</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>z</span><span style=color:green>.</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>sfx</span><span style=color:green> в папке с программой и выполните замену перевода хотя бы одного диалога 500 на рекомендуемый мной следующий:</span><span style=color:#339966><o:p></o:p></span></p><p class=MsoNormal><span style=color:#339966><o:p>&nbsp;</o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>500 DIALOG 0, 0, 186, 27<o:p></o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>STYLE DS_FIXEDSYS | DS_MODALFRAME | DS_CENTER | WS_POPUP | WS_CAPTION<o:p></o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>CAPTION &quot;</span><span style='font-size:10.0pt;font-family:"Courier New CYR"'>Извлечение</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New CYR";mso-ansi-language:
EN-US'>&quot;<o:p></o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New CYR";mso-ansi-language:
EN-US'>LANGUAGE LANG_ENGLISH, SUBLANG_ENGLISH_US<o:p></o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New CYR";mso-ansi-language:
EN-US'>FONT 8, &quot;MS Shell Dlg&quot;<o:p></o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New CYR";mso-ansi-language:
EN-US'>{<o:p></o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New CYR";mso-ansi-language:
EN-US'><span style=mso-spacerun:yes>   </span>CONTROL &quot;Progress1&quot;, 1000, &quot;msctls_progress32&quot;, PBS_SMOOTH | WS_CHILD | WS_VISIBLE | WS_BORDER, 7, 7, 172, 14<o:p></o:p></span></p><p class=MsoNormal style=mso-layout-grid-align:none;text-autospace:none><span style='font-size:10.0pt;font-family:"Courier New CYR"'>}<o:p></o:p></span></p><p class=MsoNormal><span style=color:#339966><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Данные исправления изменяют диалог выполнения и убирают кнопку Отмены и Закрытия архива в момент распаковки (пользователь не будет иметь возможности нажать на кнопку отмены).<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Может возникнуть проблемка в следующем: при деинсталляции файлы, извлеченные из архива, не удаляться, поскольку они не были запомнены инсталлятором. В таком случае лучше сделать так:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>UninstallDelete</span><span style=color:black>]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Type</span><span style=color:black>: </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>filesandordirs</span><span style=color:black>; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span style=color:black>: &quot;{</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>app</span><span style=color:black>}&quot;<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Будьте очень осторожны в таких случаях! Удаляется полностью вся папка, куда было установлено приложение! Поэтому не позволим пользователю установить программу в уже существующую папку:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function<b style=mso-bidi-font-weight:normal> </b></span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:black;mso-ansi-language:EN-US>NextButtonClick</span></b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>(CurPage: Integer): Boolean;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>s, s2:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result:=True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPage=wpSelectDir<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>s2:=ExpandConstant('{app}')+'';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>If</span><span lang=EN-US style=color:black> </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>DirExists</span><span style=color:black>(</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>s</span><span style=color:black>2)<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>then</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>s</span><span style=color:black>:='Установка в существующую папку в целях безопасности невозможна!';<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox(s, mbError, mb_Ok);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>При деинсталляции нужно честно предупредить пользователя:).<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> InitializeUninstall</span></b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>(): Boolean;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox('</span><span style=color:black>Внимание</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>! </span><span style=color:black>Сейчас удалятся все файлы игры, включая сохранения.', mbError, MB_OK)<o:p></o:p></span></p><p class=MsoNormal><span style=color:black>Result:=</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>T</span><span style=color:black>rue<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Можно и не предупреждать, если сохранения хранятся не в одной папке с игрой.</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Сейчас заставим инсталлятор проиграть музыку форматов </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Wave</span><span lang=EN-US style=color:green> </span><span style=color:green>и </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>MIDI</span><span lang=EN-US style=color:green> </span><span style=color:green>через системную </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:#003300;mso-ansi-language:EN-US>winmm</span><span style=color:#003300>.</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:#003300;mso-ansi-language:EN-US>dll</span></b><span style=color:green>.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Для проигрывания </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>WAVE</span><span lang=EN-US style=color:green> </span><span style=color:green>делаем так:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\sound.wav&quot;;</span><span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'> DestDir</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>: &quot;{tmp}&quot;; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Flags</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>sndPlaySound(lpszSoundName:</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>; uFlags: cardinal):integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> 'sndPlaySoundA@winmm.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>InitializeWizard</span></b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>();<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>ExtractTemporaryFile(ExpandConstant('sound.wav')); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Извлекаем</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>звуковой</span><span style='color:
green;mso-ansi-language:EN-US'> </span><span style=color:green>файл</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>во</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>временную</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>папку</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>sndPlaySound(ExpandConstant('{tmp}\sound.wav'), $0001 </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>or</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> $0008); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Проигрываем</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>файл</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>. </span><span style=color:green>Здесь указаны параметры для повторного проигрывания. Если мы хотим проиграть файл единожды, удаляем параметр 'or $0008'</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Для проигрывания MIDI делаем так:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\sound.mid&quot;; </span><span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'>DestDir</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>: &quot;{tmp}&quot;;</span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'> Flags</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> mciSendString(lpstrCommand: </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>string</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>; lpstrReturnString: </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>; uReturnLength:integer; hwndCallback:integer):integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> 'mciSendStringA@winmm.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard</b>();<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>ExtractTemporaryFile(ExpandConstant('sound.mid'));<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>mciSendString(ExpandConstant('play {tmp}\sound.mid'),'NULL',0,0);<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Как сделать повторение воспроизведения midi не знаю.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Сейчас будем проигрывать трекерную музыку формата *.</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>xm</span><span lang=EN-US style=color:green> </span><span style=color:green>через библиотеку MiniFMOD.dll (</span><a href=http://www.cobans.net/>http://www.cobans.net</a><span style=color:green>). Кто не знает, музыка данного формата используется во многих крэках и кейгенах, а также в некоторых играх и обладает довольно неплохим качеством звучания. Данные файлы имеют маленький размер и хорошо сжимаются, к тому же звук будет одинаковым на разных компьютерах в отличие от формата </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>MIDI</span><span style=color:green>. Существуют также практически одинаковые по качеству звучания форматы, такие как: *.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>mod</span><span style=color:green>, *.</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>it</span><span style=color:green>, *.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>s</span><span style=color:green>3</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>m</span><span style=color:green>. К сожалению, данная библиотека не поддерживает данные форматы, но можно запросто их конвертировать в формат *.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>xm</span><span style=color:green>. Для этого лучше всего использовать программу </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>ModPlug</span><span lang=EN-US style=color:green> </span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Tracker</span></b><span style=color:green> (</span><a href=http://www.modplug.com/><span lang=EN-US style=mso-ansi-language:EN-US>http</span>://<span lang=EN-US style=mso-ansi-language:EN-US>www</span>.<span lang=EN-US style=mso-ansi-language:EN-US>modplug</span>.<span lang=EN-US style=mso-ansi-language:EN-US>com</span></a><span style=color:green>). При загрузке соответствующего файла во вкладке </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>General</span><span lang=EN-US style=color:green> </span><span style=color:green>нажимаем кнопку </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Change</span><span style=color:green>… и далее выбираем нужный формат, после чего сохраняем файл как обычно. Итак, в скрипте дописываем следующее:<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Files</span><span style=color:black>]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span style=color:black>: &quot;</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>C</span><span style=color:black>:\</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MiniFMOD</span><span style=color:black>.</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>dll</span><span style=color:black>&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>DestDir</span><span style=color:black>: &quot;{</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>tmp</span><span style=color:black>}&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span style=color:black>:</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>dontcopy</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;C:\music.xm&quot;; </span><span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'>DestDir</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>: &quot;{tmp}&quot;;<span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>:dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>определяем</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>процедуры</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>и</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>функции</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> SongLoadFromFile(FileName: PChar): Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> 'SongLoadFromFile@files:minifmod.dll cdecl delayload';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> SongPlay(hMod: Integer);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> 'SongPlay@files:minifmod.dll cdecl delayload';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>//при запуске инсталлятора выполняем вот этот код:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard</b>();<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>hMod: Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Name1: </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>string</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>ExtractTemporaryFile(ExpandConstant('MiniFMOD.dll')); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//извлекаем во временную папку MiniFMOD.dll</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>ExtractTemporaryFile(ExpandConstant('music.xm')); </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//извлекаем во временную папку музыкальный файл<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Name</span><span style=color:black>1:=</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>ExpandConstant</span><span style=color:black>('{</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>tmp</span><span style=color:black>}\</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>music</span><span style='color:
black'>.</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>xm</span><span style=color:black>'); </span><span style=color:green>//определяем путь, где находится музыкальный файл</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>hMod</span><span style=color:black> := </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>SongLoadFromFile</span><span style=color:black>(</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>PChar</span><span style=color:black>(</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>Name</span><span style=color:black>1)); </span><span style='color:
green'>//загружаем музыкальный файл</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SongPlay</span><span style=color:black>(</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>hMod</span><span style=color:black>); </span><span style=color:green>//запускаем воспроизведение музыки</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Если программа рассчитана только для </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>NT</span><span lang=EN-US style=color:green> </span><span style=color:green>платформы, то имеет смысл добавить в инсталлятор следующую функцию:</span><span style=color:black><o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US> <b style=mso-bidi-font-weight:normal>InitializeSetup</b>(): Boolean;<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span><span style=color:blue>if</span> UsingWinNT=True<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result:=True<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;color:blue;mso-ansi-language:EN-US>else</span><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>MsgBox('</span><span style=font-size:12.0pt>Программа</span><span style=font-size:12.0pt;mso-ansi-language:EN-US> </span><span style=font-size:12.0pt>может</span><span style='font-size:12.0pt;mso-ansi-language:
EN-US'> </span><span style=font-size:12.0pt>быть</span><span style=font-size:12.0pt;mso-ansi-language:EN-US> </span><span style=font-size:12.0pt>установлена</span><span style='font-size:12.0pt;
mso-ansi-language:EN-US'> </span><span style=font-size:12.0pt>только</span><span style=font-size:12.0pt;mso-ansi-language:EN-US> </span><span style=font-size:12.0pt>на</span><span style='font-size:12.0pt;mso-ansi-language:
EN-US'> <span lang=EN-US>NT </span></span><span style=font-size:12.0pt>платформу</span><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US>!', mbError, mb_OK);<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result</span><span style=font-size:12.0pt>:=</span><span lang=EN-US style=font-size:12.0pt;mso-ansi-language:EN-US>False</span><span style=font-size:12.0pt>;<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;color:blue;mso-ansi-language:EN-US>end</span><span style=font-size:12.0pt>;<o:p></o:p></span></p><p class=MsoBodyTextIndent2 style=text-indent:0cm><span lang=EN-US style=font-size:12.0pt;color:blue;mso-ansi-language:EN-US>end</span><span style=font-size:12.0pt>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Сейчас будем распаковывать инсталлятор, почти со всеми потрохами. Для этого нам понадобится распаковщик </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Inno</span><span lang=EN-US style=color:blue> </span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Unpacker</span><span lang=EN-US style=color:blue> </span></b><span style=color:green>(</span><a href=http://www.innounp.sourceforge.net/><span lang=EN-US style=mso-ansi-language:EN-US>http</span>://<span lang=EN-US style=mso-ansi-language:EN-US>www</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>innounp</span>.<span lang=EN-US style=mso-ansi-language:EN-US>sourceforge</span>.<span lang=EN-US style=mso-ansi-language:EN-US>net</span></a><span style=color:green>). Данный распаковщик позволяет извлечь из инсталлятора все включенные в сборку файлы и записи реестра без повреждения, хотя будьте осторожны – вы можете при работе с распаковщиком повредить сам инсталлятор. Данная программка запускается с помощью командной строки. Лично мне для извлечения хватает следующего:<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>C:</span></b><span lang=EN-US style=color:black;mso-ansi-language:EN-US>\&gt;<b style='mso-bidi-font-weight:
normal'>innounp.exe setup.exe -x -m<o:p></o:p></b></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></b></p><p class=MsoNormal><span style=color:green>Мы указываем путь к программе, затем название инсталлятора и параметры для извлечения (инсталлятор должен находится в одной директории с распаковщиком). Данные параметры позволяют извлечь из инсталлятора все файлы с сортировкой их по папкам, т.е. файлы программы в папке {</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>app</span><span style=color:green>} (в некоторых случаях, если при распаковке имеются несколько одинаковых файлов с названиями типа: </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>file</span><span style=color:green>.</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>exe</span><span style=color:green>, </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>file</span><span style=color:green>,1.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>exe</span><span style=color:green>, </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>file</span><span style=color:green>,2.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>exe</span><span style=color:green>, то следует учитывать, что на самом деле в инсталлятор включен только один из таких файлов с названием без цифр, т.е. </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>file</span><span style=color:green>.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>exe</span><span style=color:green>), системные файлы в папке {</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>sys</span><span style=color:green>} и т.д. Также извлекаются в отдельную папку изображения инсталлятора, документы и, во многих случаях, файл </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>CompiledCode</span><span style=color:green>.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>bin</span><span style=color:green>, содержащий информацию секции [</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Code</span><span style=color:green>] скрипта в зашифрованном виде, и файл сценария </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>install</span><span style=color:green>.</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>iss</span><span style=color:green>. Итак, что реально полезного мы можем узнать, применив распаковщик? Во-первых, мы узнаем, какие файлы действительно участвуют в инсталляционном процессе. Во-вторых, мы можем получить оригинальные изображения инсталлятора. В-третьих, открыв кривоватый скрипт, мы получаем точные данные реестра, а также можем узнать, какие файлы были задействованы как компоненты. Скрипт, который получается при распаковке, очень кривой, поэтому не стоит брать его за основу. Из него можно выдрать только значения реестра, а также посмотреть расположение ярлыков и секцию задач и компонентов. В остальном большая недостача и много лишнего и неправильного. Но многих заинтересует файл </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>CompiledCode</span><span style=color:green>.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>bin</span><span style=color:green>. Его также можно распаковать, но код, полученный после распаковки, приобретет непривычный для многих вид и может быть непонятен тем, кто напрямую не связан с программированием. Сам распаковщик-дизассемблер ищите на вышеуказанном сайте. Возможно, когда-нибудь выйдет «пряморукая» версия распаковщика, а пока приходится довольствоваться тем, что есть.</span><b style=mso-bidi-font-weight:normal><span style=color:black><o:p></o:p></span></b></p><p class=MsoNormal align=center style=text-align:center><b style='mso-bidi-font-weight:
normal'><span style=color:black><o:p>&nbsp;</o:p></span></b></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Те, кто из вас пользуется русификаторами, должны встречаться с патчером-инсталлятором </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>PatchWise</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Free</span><span style=color:green>. При желании русифицировать не ту версию программы в нем перед началом обновления появляется сообщение о несоответствии целостности и на этом установка завершается. Что</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>ж</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>, </span><span style=color:green>попробуем</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>сделать</span><span style='color:green;
mso-ansi-language:EN-US'> </span><span style=color:green>также</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurStepChanged</b>(CurStep: TSetupStep);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>s:</span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>string</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>sz:Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> CurStep=ssInstall<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> FileSize(ExpandConstant('{app}')+'\File.exe', sz)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> sz&lt;&gt;854016<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>s</span><span style=color:black>:='Неверный размер обновляемого файла </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>File</span><span style=color:black>.</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>exe</span><span style=color:black>!' #13#13 'Удостоверьтесь в соответствии требуемого размера.';<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox</span><span style=color:black>(</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>s</span><span style=color:black>, </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>mbCriticalError</span><span style=color:black>, </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>mb</span><span style=color:black>_</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Ok</span><span style=color:black>); </span><span style=color:green>//Если размер проверяемого файла(ов) не соответствует, выдается сообщение, и на этом все действия прекращаются.</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm</span><span style=color:black>.</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>Close</span><span style=color:black>; </span><span style=color:green>//Закрытие инсталлятора</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Abort</span><span style=color:black>; </span><span style=color:green>//Прерывание всех действий</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>При тестировании инсталлятора, дойдя до операции Прерывания, компилятор может выдавать ошибку, но готовый инсталлятор никакой ошибки выдавать не будет. Не</span><span style='color:green;
mso-ansi-language:EN-US'> </span><span style=color:green>забываем</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>дописать</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>еще</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>такую</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>процедуру</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CancelButtonClick</b>(CurPage: Integer; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> Cancel, Confirm: Boolean);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>begin</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Cancel</span><span style=color:black>:=</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>True</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>If</span><span lang=EN-US style=color:black> </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>CurPage</span><span style=color:black>=12</span><span style=color:green> //Это непосредственно страница с индикатором выполнения<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Confirm</span><span style=color:black>:=</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>False</span><span style=color:black>; </span><span style=color:green>//На этой странице отключаем появление сообщения при нажатии на кнопку Отмена</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Хоть </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Inno</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>Setup</span><span lang=EN-US style=color:green> </span><span style=color:green>и не имеет проверку целостности (</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>CRC</span><span style=color:green>), но, тем не менее, обновление можно сделать подобным образом.</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style=text-align:center><b style='mso-bidi-font-weight:
normal'><u><span style=font-size:14.0pt;color:green>Нововведения версии </span></u></b><b style=mso-bidi-font-weight:normal><u><span lang=EN-US style='font-size:14.0pt;
color:green;mso-ansi-language:EN-US'>4</span></u></b><b style='mso-bidi-font-weight:
normal'><u><span style=font-size:14.0pt;color:green>.0<o:p></o:p></span></u></b></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Итак, представляю свое решение по шифровке инсталлятора, используя модуль <b style=mso-bidi-font-weight:normal>ISCrypt.dll</b>, который доступен для скачивания на оф.сайте. Нужно это для того, чтобы обычный пользователь не смог распаковать инсталлятор посредством распаковщика </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>I</span><span style=color:green>nno </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>U</span><span style=color:green>npacker. Смысл такой: задаем пароль для инсталлятора, который автоматически вставляется в поле ввода и посредством специальной функции сама страница нажимается автоматически. Пароль сами устанавливаем такой, чтобы никто его не смог подобрать, желательно добавить русские и обязательно специальные символы. Специальные символы можно вставить, например, из </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Word</span></b><span style=color:green>-а. Они нужны для того, чтобы пользователь не смог набрать пароль вручную и даже вставить из буфера обмена. Есть плагин для </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Total</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Commander</span><span style=color:green>, который распаковывает инсталляторы </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Inno</span><span lang=EN-US style=color:green> </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Setup</span><span style=color:green>, так<span style=mso-spacerun:yes>  </span>вот: этим плагином можно извлечь файл </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>CompiledCode</span><span style=color:green>.</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>bin</span><span style=color:green>, в котором при просмотре легко можно найти пароль. При запросе пароля распаковщик при вводе русских символов (даже если все правильно) не определит пароль как правильный, но мы еще подстрахуемся – добавим спецсимволы, которые командная строка определит как ? (неизвестный), например:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[Setup]<o:p></o:p></span></b></p><p class=MsoNormal><span style=color:green>;Модуль ISCrypt.dll должен находиться в папке с компилятором<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>Encryption</span><span style=color:black>=yes</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>;</span><span style=color:green>Не</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>добавляйте</span><span style='color:green;
mso-ansi-language:EN-US'> <span lang=EN-US>Unicode </span></span><span style=color:green>символы</span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>! </span><span style=color:green>Не</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>все</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>понимаются</span><span style=color:green;mso-ansi-language:EN-US> </span><span style=color:green>инсталлятором</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>.<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Password</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>=</span><span style=color:black>фырлджэ</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>\5(*&amp;Y<span style=mso-special-character:footnote-separator><![if !supportFootnotes]><hr align=left size=1 width=33%><![endif]></span></span><span style=color:black>Ю</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>±±°</span><span style=color:black>є<span lang=AR-SA dir=RTL>&#65265;</span></span><span dir=LTR></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span dir=LTR></span>©®™&#8734;€&yen;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard()</b>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Вставляем наш пароль в поле ввода<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WizardForm.PasswordEdit.Text := '</span><span style=color:black>фырлджэ</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>\5(*&amp;Y<span style='mso-special-character:
footnote-separator'><![if !supportFootnotes]><hr align=left size=1 width=33%><![endif]></span></span><span style=color:black>Ю</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>±±°</span><span style=color:black>є<span lang=AR-SA dir=RTL>&#65265;</span></span><span dir=LTR></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span dir=LTR></span>©®™&#8734;€&yen;';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>//При установке юзер не поймает пароль по маске<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurPageChanged</b>(CurPageID: Integer);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurPageID=wpPassword</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SendMessage(WizardForm.NEXTBUTTON.Handle, 513, 0, 0)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>SendMessage(WizardForm.NEXTBUTTON.Handle, 514, 0, 0)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Теперь инсталлятор в безопасности</span><span lang=EN-US style='font-family:Wingdings;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:green;mso-ansi-language:EN-US;
mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span style='mso-char-type:
symbol;mso-symbol-font-family:Wingdings'>J</span></span><span style='color:
green'>. Имейте в виду, что шифруются только основные файлы. Следует еще запомнить, что в тех случаях, когда вы извлекаете во временную папку внешние файлы, не забудьте установить для них флаг </span><span style=color:black>noencryption</span><span style=color:green> в секции [</span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Files</span><span style=color:green>].<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Сейчас будем производить удаление и проверять, осталась ли папка, если да – выполнять соответствующие действия.<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Code</span><span style=color:black>]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurUninstallStepChanged</b>(CurUninstallStep: TUninstallStep);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Res: Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'><span style=mso-spacerun:yes> </span>case</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CurUninstallStep</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> of</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>usPostUninstall:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Проверяем присутствие папки после удаления</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> DirExists(ExpandConstant('{app}')+'')<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes>   </span></span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//Создаем диалог с тремя кнопками<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>     </span></span><span style=color:blue><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>case</span><span lang=EN-US style=color:black> </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox</span><span style=color:black>('Папка &quot;'+</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>ExpandConstant</span><span style=color:black>('{</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>app</span><span style=color:black>}')+'&quot; не пуста.'#13#13 +<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>       </span>'&quot;Да&quot; – полное удаление всех файлов в папке, включая саму папку.' </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>#13#13 +<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>       </span>'&quot;Нет&quot; – открыть папку в проводнике, чтобы вручную удалить файлы.'#13#13 +<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>       </span>'&quot;Отмена&quot; – ничего не делать, удалить папку позже самостоятельно.', </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>mbInformation</span><span style=color:black>, </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MB</span><span style=color:black>_</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>YESNOCANCEL</span><span style=color:black>)<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>     </span></span><span style=color:blue><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>of</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> IDYES:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>   </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if not</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> DelTree(ExpandConstant('{app}')+'', True, True, True)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>then<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>   </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox</span><span style=color:black>('Папка не удалена.' #13#13 'Папка или один из файлов в ней задействованы другим приложением.', </span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>mbError</span><span style=color:black>, </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MB</span><span style=color:black>_</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>OK</span><span style=color:black>);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>IDNO:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>if not</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> ShellExec('open', ExpandConstant('{app}')+'', '', '', SW_SHOWMAXIMIZED, ewNoWait, Res)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>then<o:p></o:p></span></p><p class=MsoNormal><span style=color:black><span style=mso-spacerun:yes>   </span></span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>MsgBox</span><span style=color:black>('Ошибка открытия.' #13#13 'Папка не найдена.', </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>mbError</span><span style=color:black>, </span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>MB</span><span style=color:black>_</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>OK</span><span style=color:black>);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>IDCANCEL:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span style=color:black>;</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Нас, возможно, не устраивает шрифт инсталлятора по умолчанию – исправим это:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[LangOptions]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>LanguageName=Russian<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>LanguageID=$0419<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>LanguageCodePage=1251<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>DialogFontName=Tahoma<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>DialogFontSize=8<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WelcomeFontName=Times New Roman<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>WelcomeFontSize=13<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>TitleFontName=Arial<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>TitleFontSize=29<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>CopyrightFontName=Arial<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>CopyrightFontSize=8<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Изменение размера шрифта может повлечь изменение размера самого инсталлятора – будьте осторожны.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:black><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Многие программы имеют отдельные папки с проектами. Эти папки указываются либо программой, либо программой установки. Мы попытаемся сделать страничку, где пользователю будет предложено выбрать путь к папке с проектами. Помимо создаваемой папки, инсталлятор пропишет в реестр (нужно знать программе) путь ее расположения.<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Dirs]<o:p></o:p></span></b></p><p class=MsoNormal><span style=color:green>;Создание указанной папки, которую не будем деинсталлировать в дальнейшем<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Name</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: {code:GetDataDir}; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Flags</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: uninsneveruninstall<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>[Registry]</span><span style=color:black><o:p></o:p></span></b></p><p class=MsoNormal><span style=color:green>;Пример записи указанной папки в реестр</span><b style=mso-bidi-font-weight:normal><span style=color:black><o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Root</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: HKCU; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Subkey</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;Software\Indigo Rose\AutoPlay Media Studio 6.0&quot;;</span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'> ValueType</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: string; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>ValueName</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>: &quot;InstallProjectsFolder&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>ValueData</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>: &quot;{code:GetDataDir}&quot;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Code]</span><o:p></o:p></b></p><p class=MsoNormal><span style=color:green>//Определяем дополнительную страницу (с кнопкой «Обзор…»)</span><b style=mso-bidi-font-weight:normal><o:p></o:p></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=mso-spacerun:yes>  </span><span lang=EN-US style=mso-ansi-language:EN-US>DataDirPage</span>: <span lang=EN-US style=mso-ansi-language:EN-US>TInputDirWizardPage</span>;</p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=color:blue> </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>InitializeWizard</span>()</b>;</p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//Создание дополнительной страницы после указанной</span> <span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>wpSelectProgramGroup</span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US><o:p></o:p></span></b></p><p class=MsoNormal><span style=mso-spacerun:yes>  </span><span lang=EN-US style=mso-ansi-language:EN-US>DataDirPage</span> := <span lang=EN-US style=mso-ansi-language:EN-US>CreateInputDirPage</span>(<span lang=EN-US style=mso-ansi-language:EN-US>wpSelectProgramGroup</span>,</p><p class=MsoNormal><span style=mso-spacerun:yes>    </span>'Выбор папки с проектами', 'В какой папке будут находиться ваши проекты?',</p><p class=MsoNormal><span style=mso-spacerun:yes>    </span>'Пожалуйста, укажите папку, в которой будут сохранены проекты программы.'#13#13'Путь к папке с проектами может быть изменен в &quot;Правка&quot;&gt;&quot;Предпочтения&quot;.',</p><p class=MsoNormal><span style=mso-spacerun:yes>    </span><span lang=EN-US style=mso-ansi-language:EN-US>False, '');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>DataDirPage.Add('');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>DataDirPage.Values[0] := GetPreviousData('DataDir', '');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>NextButtonClick</b>(CurPage: Integer): Boolean;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>if</span><span lang=EN-US style='mso-ansi-language:
EN-US'> DataDirPage.Values[0] = ''<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>then</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//Указываем путь папки с проектами по умолчанию</span></p><p class=MsoNormal><span style=mso-spacerun:yes>   </span><span lang=EN-US style=mso-ansi-language:EN-US>DataDirPage.Values[0] := (ExpandConstant('{userdocs}')+'\AutoPlay Media Studio 6.0 Projects');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result := True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function </span><span lang=EN-US style=mso-ansi-language:EN-US>GetDataDir(Param: <span style=color:blue>String</span>):<span style=color:blue> String</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result := DataDirPage.Values[0];<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>//Это страница, в которой отображаются выбранные параметры установки<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//Чтобы в нее прописать указанный путь установки папки с проектами, пишем следующую функцию<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//По необходимости указываем дополнительные параметры установки (компоненты и т.п.)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>UpdateReadyMemo</span></b><span lang=EN-US style=mso-ansi-language:EN-US>(Space, NewLine, MemoUserInfoInfo, MemoDirInfo, MemoTypeInfo,<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>MemoComponentsInfo, MemoGroupInfo, MemoTasksInfo: <span style=color:blue>String</span>): <span style='color:
blue'>String</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S: <span style=color:blue>String</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + MemoDirInfo;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + NewLine + NewLine;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + MemoGroupInfo;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + NewLine + NewLine;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + 'Папка с проектами:' + NewLine + Space;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + DataDirPage.Values[0];<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + NewLine + NewLine;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>S := S + MemoTasksInfo;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result := S;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span>;</p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>Теперь приведу примеры создания серийных номеров для инсталлятора. В идеале используйте с описанным шифрованием инсталлятора. Хотя узнать такой серийник особого труда не составит.<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Setup</span><span style=color:black>]<o:p></o:p></span></b></p><p class=MsoNormal><span style=color:green>;Добавляем страницу с данными пользователя и полем ввода серийного номера</span><b style='mso-bidi-font-weight:
normal'><span style=color:black><o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>UserInfoPage</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>=yes<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Code]</span><o:p></o:p></b></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Указываем</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>серийные</span><span style='color:
green;mso-ansi-language:EN-US'> </span><span style=color:green>номера</span><span lang=EN-US style=mso-ansi-language:EN-US><br> <span style=color:blue>function</span> CheckSerial(Serial: String): Boolean;<br> <span style=color:blue>begin</span><br> <span style=color:blue>If </span>(Serial='4422-93598-8995') <span style=color:blue>or</span><br> <span style=mso-spacerun:yes> </span>&nbsp; (Serial='8474-05768-1841')<span style=color:blue> then</span><span style=color:black><br> &nbsp; Result:=True</span><br> <span style=color:blue>else<br> &nbsp;begin</span><br> &nbsp; Result:=False;<br> <span style=color:blue>&nbsp;end</span>;<br> <span style=color:blue>end</span>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>Или сделаем ввод серийного номера по определенной маске, где # - цифры * - большие буквы. Серийник при этом любой, главное, чтобы он соответствовал указанной маске.<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> CheckSerial(Serial: </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>String</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>): Boolean;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>mask:string;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>i:Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Result:=True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US>mask:='####-####-##****';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Length(Serial)&lt;&gt;Length(mask) </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>Result:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>exit</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>For</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> i:=1</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> to</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> Length(mask)</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> do</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> StrGet(mask, i)='#' </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If not</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> ((Ord(StrGet(Serial, i))&gt;=48) </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>and</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> (Ord(StrGet(Serial, i))&lt;=57)) </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>exit</span><span lang=EN-US style='color:
black;mso-ansi-language:EN-US'>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>end</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'> StrGet(mask, i)='*'</span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US> then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If not</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US> ((StrGet(Serial, i)&gt;='A') </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>and </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>(StrGet(Serial, i)&lt;='Z')) </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:black;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>Result:=False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>exit</span><span lang=EN-US style='color:
black;mso-ansi-language:EN-US'>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>end</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span><span style=color:black>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Вот еще красивая реализация пароля:</span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal>[</b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='mso-ansi-language:
EN-US'>Code</span>]<o:p></o:p></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>KeyPage: TInputQueryWizardPage;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>ProgressPage: TOutputProgressWizardPage;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard</b>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>KeyPage := CreateInputQueryPage(wpWelcome,<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span></span>'Персональная информация', 'Какой пароль необходим для продолжения?',</p><p class=MsoNormal><span style=mso-spacerun:yes>    </span>'Вы должны ввести пароль, который позволит дальнейший ход выполнения установочных действий. ' +</p><p class=MsoNormal><span style=mso-spacerun:yes>    </span>'Пароль находится в сопутствующем readme.txt.');</p><p class=MsoNormal><span style=mso-spacerun:yes>  </span>KeyPage.Add('Пароль:', False);</p><p class=MsoNormal><span style=mso-spacerun:yes>  </span>ProgressPage := CreateOutputProgressPage('Персональная информация',</p><p class=MsoNormal><span style=mso-spacerun:yes>    </span>'Какой пароль необходим для продолжения?');</p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>NextButtonClick</span></b><span lang=EN-US style=mso-ansi-language:EN-US>(CurPageID: Integer): Boolean;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>I: Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>     </span>Result := True;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>if</span><span lang=EN-US style='mso-ansi-language:
EN-US'> CurPageID = KeyPage.ID <span style=color:blue>then begin</span><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span></span>ProgressPage.SetText('Проверка введенного пароля...', '');</p><p class=MsoNormal><span style=mso-spacerun:yes>    </span><span lang=EN-US style=mso-ansi-language:EN-US>ProgressPage.SetProgress(0, 0);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>ProgressPage.Show;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span><span style=color:blue>try<o:p></o:p></span></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>      </span>for</span><span lang=EN-US style=mso-ansi-language:EN-US> I := 0 <span style=color:blue>to</span> 10 <span style=color:blue>do begin</span><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>        </span>ProgressPage.SetProgress(I, 10);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>        </span>Sleep(100);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>      </span><span style=color:blue>end</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>finally<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>      </span>ProgressPage.Hide;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span><span style=color:blue>end</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Здесь указываем пароль<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>   </span><span style=color:blue><span style=mso-spacerun:yes> </span>if</span> KeyPage.Values[0] = '</span>Мой<span style=mso-ansi-language:EN-US> </span>пароль<span lang=EN-US style=mso-ansi-language:EN-US>' <span style=color:blue>then</span><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>      </span></span>Result := True</p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes>    </span>else begin<o:p></o:p></span></p><p class=MsoNormal><span style=mso-spacerun:yes>      </span>MsgBox('Вы должны ввести правильный пароль. (Он указан в файле readme.txt.)', mbError, MB_OK);</p><p class=MsoNormal><span style=mso-spacerun:yes>      </span><span lang=EN-US style=mso-ansi-language:EN-US>Result := False;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>end else<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>Result := True;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>Многие из вас видели, как игровые инсталляторы копируют файлы русификации из отдельной папки, находящейся рядом с инсталлятором. Сделать это довольно просто, например:<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal>[</b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='mso-ansi-language:
EN-US'>Components</span>]<o:p></o:p></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span>: &quot;<span lang=EN-US style=mso-ansi-language:EN-US>rus</span>&quot;; <span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Description</span>: &quot;Русская версия&quot;; <span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'>Types</span>: <span lang=EN-US style=mso-ansi-language:EN-US>rus</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=mso-ansi-language:EN-US>: &quot;eng&quot;; <span style=color:blue>Description</span>: &quot;Английская версия&quot;;<span style=color:blue> Types</span>: eng<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Types]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=mso-ansi-language:EN-US>: &quot;rus&quot;; <span style=color:blue>Description</span>: &quot;На русском языке&quot;;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Name</span><span lang=EN-US style=mso-ansi-language:EN-US>: &quot;eng&quot;; <span style=color:blue>Description</span>: &quot;На английском языке&quot;;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: &quot;D:\HL2EP1\*&quot;; <span style=color:blue>DestDir</span>: &quot;{app}&quot;; <span style=color:blue>Flags</span>: ignoreversion recursesubdirs createallsubdirs<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Components</span><span lang=EN-US style=mso-ansi-language:EN-US>: rus; <span style=color:blue>Source</span>: &quot;{src}\Rus\*&quot;; <span style=color:blue>DestDir</span>: &quot;{app}&quot;; <span style=color:blue>Flags</span>: ignoreversion recursesubdirs createallsubdirs external</span></p><p class=MsoNormal><span style=color:green>Обратите внимание на флаг </span><span lang=EN-US style=mso-ansi-language:EN-US>external</span><span style=color:green>. Именно из-за него происходит копирование всех файлов из папки «</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Rus</span><span style=color:green>» в указанную директорию. Таким образом, можно произвести установку всей игры, указав в </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Source</span><span style=color:green>, например, папку &quot;{</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>src</span><span style=color:green>}\</span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>Data</span><span style=color:green>&quot;, в которой будут храниться все файлы игры, не забывая про флаг </span><span lang=EN-US style='mso-ansi-language:
EN-US'>external</span><span style=color:green>. В этом случае инсталлятор скомпилируется за пару секунд. Это может использоваться для упаковки игр, файлы которых практически не сжимаются, например, игры на движке </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>DooM</span><span style=color:green>3.<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>Вы, наверное, замечали, как после установки в фоновом режиме устанавливаются различные кодеки, но у вас не получалось сделать так же. Различные пакеты кодеков от «мелкософта» зачастую для фоновой установки используют параметр </span><span style=color:black>/</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>q</span><span style=color:green>. Для фоновой установки </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:green;mso-ansi-language:EN-US>DirectX</span></b><span lang=EN-US style=color:green> </span><span style=color:green>используйте параметр </span><span style=color:black>/</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>silent</span><span style=color:green>.<b style=mso-bidi-font-weight:normal><o:p></o:p></b></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[Run]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Filename</span><span style=color:black>: &quot;{</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>src</span><span style=color:black>}\</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Redist</span><span style=color:black>\</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>WM</span><span style=color:black>9</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Codecs</span><span style=color:black>.</span><span lang=EN-US style='color:black;mso-ansi-language:
EN-US'>exe</span><span style=color:black>&quot;; </span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>WorkingDir</span><span style=color:black>: &quot;{</span><span lang=EN-US style='color:black;
mso-ansi-language:EN-US'>src</span><span style=color:black>}\</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>Redist</span><span style=color:black>&quot;; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>Parameters</span><span style=color:black>: &quot;/</span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>q</span><span style=color:black>&quot;; </span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>StatusMsg</span><span style=color:black>: &quot;Установка кодеков...&quot;; </span><span lang=EN-US style='color:blue;mso-ansi-language:
EN-US'>Flags</span><span style=color:black>: </span><span lang=EN-US style=color:black;mso-ansi-language:EN-US>waituntilterminated</span><span style=color:black><o:p></o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>Сейчас будет рассказано, как прописать нужную строку в </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>host</span><span lang=EN-US style=color:green> </span><span style=color:green>и сделать его резервную копию:</span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal>[Code]<o:p></o:p></b></p><p class=MsoNormal><span style=color:green>//О сохранении бэкапа пользователя уведомлять не будем<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//Создаем резервную копию в начале установки<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>procedure</span> <b style=mso-bidi-font-weight:normal>CurPageChanged</b>(CurPageID: Integer);</p><p class=MsoNormal><span style=color:blue>var<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><span style=mso-spacerun:yes> </span>//определяемые строки для сохранения резервных файлов<o:p></o:p></span></p><p class=MsoNormal><span style=mso-spacerun:yes> </span><span lang=EN-US style=mso-ansi-language:EN-US>s1, s2:<span style=color:blue>string</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If</span><span lang=EN-US style=mso-ansi-language:EN-US> CurPageID=wpInstalling <span style=color:blue>then<o:p></o:p></span></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>s1:=ExpandConstant('{sys}')+'\drivers\etc\host';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>s2:=ExpandConstant('{sys}')+'\drivers\etc\Backup_Host_File';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style='mso-ansi-language:
EN-US'> FileExists(s1)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>CreateDir(s2);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>FileCopy(s1, s2+'\host', True);<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><span style=color:green>//Если программа устанавливается повторно, и был зарезервирован файл 'host', то перезапись файла в резервной папке не осуществится<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style=color:green>//Дописываем строку в 'host' на завершающем этапе установки<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>CurStepChanged</span></b><span lang=EN-US style=mso-ansi-language:EN-US>(CurStep: TSetupStep);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If </span><span lang=EN-US style=mso-ansi-language:EN-US>CurStep=ssPostInstall<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>then<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>begin<o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//Строка будет дописываться под последней существующей<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>SaveStringToFile(ExpandConstant('{sys}')+'\drivers\etc\host', #13 + '</span>требуемая<span style=mso-ansi-language:EN-US> </span>строка<span lang=EN-US style=mso-ansi-language:EN-US>', True);<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>//Деинсталляция. В процессе удаления происходит восстановление требуемого файла и полное удаление резервной папки<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurUninstallStepChanged</b>(CurUninstallStep: TUninstallStep);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>var<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>s1, s2, s3:<span style=color:blue>string</span>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>case</span><span lang=EN-US style='mso-ansi-language:
EN-US'> CurUninstallStep <span style=color:blue>of</span><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>usPostUninstall:<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>s1:=ExpandConstant('{sys}')+'\drivers\etc\Backup_Host_File\host';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>s2:=ExpandConstant('{sys}')+'\drivers\etc';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>If</span><span lang=EN-US style='mso-ansi-language:
EN-US'> FileExists(s1)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes> </span>FileCopy(s1, s2+'\host', False);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>s3:=ExpandConstant('{sys}')+'\drivers\etc\Backup_Host_File';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>If</span><span lang=EN-US style=mso-ansi-language:EN-US> DirExists(s3)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Очень</span><span style='color:green;mso-ansi-language:
EN-US'> </span><span style=color:green>опасная</span><span style='color:green;
mso-ansi-language:EN-US'> </span><span style=color:green>функция</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>! </span><span style=color:green>Удаляет беспощадно файлы в указанной папке вместе с папкой!!!<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>DelTree(ExpandConstant('{sys}')+'\drivers\etc\Backup_Host_File', True, True, True);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>В самом начале руководства было рассказано, как вставлять фоновое (</span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>BMP</span><span style=color:green>) изображение в инсталлятор. Сейчас же рассмотрим самый простой пример вставки </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>JPEG</span><span lang=EN-US style=color:green> </span><span style=color:green>или </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>GIF</span><span lang=EN-US style=color:green> </span><span style=color:green>изображений в качестве фона. Вы, вероятно, знаете, что </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>JPEG</span><span lang=EN-US style=color:green> </span><span style=color:green>и </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>GIF</span><span lang=EN-US style=color:green> </span><span style=color:green>имеют небольшой размер, по сравнению с </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>BMP</span><span lang=EN-US style=color:green> </span><span style=color:green>форматом. Чисто средствами </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Inno</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>Setup</span><span lang=EN-US style=color:green> </span><span style=color:green>этого сделать не получится, но мы будем использовать специальную для этого </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>isxbb</span><span style=color:green>.</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>dll</span><span style=color:green> (</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>BillBoard</span><span style=color:green>)</span></b><span style=color:green>, скачать которую вместе с немного кривоватыми примерами можно с </span><a href=http://www.istools.org/>http://www.istool.org</a><span style=color:green>.<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[Setup]<o:p></o:p></span></b></p><p class=MsoNormal><span style=color:blue>WindowVisible</span><span style=color:black>=yes<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>WindowResizable</span><span style=color:black>=no<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>WindowShowCaption</span><span style=color:black>=no<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: C:\isxbb.dll; <span style=color:blue>DestDir</span>: {tmp}; <span style=color:blue>Flags</span>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: C:\1.jpg; <span style=color:blue>DestDir</span>: {tmp}; <span style=color:blue>Flags</span>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>const<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>BACKGROUND=6;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=mso-ansi-language:EN-US> isxbb_AddImage(Image: PChar; Flags: Cardinal): Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=mso-ansi-language:EN-US> 'isxbb_AddImage@files:isxbb.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=mso-ansi-language:EN-US> isxbb_Init(hWnd: Integer): Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external </span><span lang=EN-US style=mso-ansi-language:EN-US>'isxbb_Init@files:isxbb.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard</b>();<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>ExtractTemporaryFile('1.jpg');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>isxbb_AddImage(ExpandConstant('{tmp}')+'\1.jpg',BACKGROUND);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>isxbb_Init(StrToInt(ExpandConstant('{hwnd}')));<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span>;</p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style=color:green>Теперь сделаем слайд-шоу (правда, без эффектов переходов) при старте установки и остановим циклический показ изображений в конце установки. Многие из вас могли видеть инсталляторы от «1С» (</span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Doom</span><span style=color:green>3 – </span><span lang=EN-US style='color:green;mso-ansi-language:
EN-US'>Resurrection</span><span lang=EN-US style=color:green> </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>of</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Evil</span><span style=color:green>, </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Prey</span><span lang=EN-US style=color:green> </span><span style=color:green>и т.д.), в которых реализована подобная фишка. Но там это делает авторан, а мы реализуем это в </span><span lang=EN-US style=color:green;mso-ansi-language:EN-US>Inno</span><span lang=EN-US style=color:green> </span><span lang=EN-US style='color:green;
mso-ansi-language:EN-US'>Setup</span><span style=color:green>, в идеале с изменением размеров страницы установки и последующим смещением ее в один из углов фонового окна (как это сделать описано в руководстве).<o:p></o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>[Setup]<o:p></o:p></span></b></p><p class=MsoNormal><span style=color:blue>WindowVisible</span><span style=color:black>=yes<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>WindowResizable</span><span style=color:black>=no<o:p></o:p></span></p><p class=MsoNormal><span style=color:blue>WindowShowCaption</span><span style=color:black>=no<o:p></o:p></span></p><p class=MsoNormal><span style=color:green><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Files]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: C:\isxbb.dll; <span style=color:blue>DestDir</span>: {tmp}; <span style=color:blue>Flags</span>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: C:\1.jpg; <span style=color:blue>DestDir</span>: {tmp}; <span style=color:blue>Flags</span>: dontcopy</span></p><p class=MsoNormal><span style=color:green>//Это файлы для слайд-шоу (может быть больше)</span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: C:\2.jpg; <span style=color:blue>DestDir</span>: {tmp}; <span style=color:blue>Flags</span>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: C:\3.jpg; <span style=color:blue>DestDir</span>: {tmp}; <span style=color:blue>Flags</span>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>Source</span><span lang=EN-US style=mso-ansi-language:EN-US>: C:\4.jpg; <span style=color:blue>DestDir</span>: {tmp}; <span style=color:blue>Flags</span>: dontcopy<o:p></o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span lang=EN-US style=mso-ansi-language:EN-US>[Code]<o:p></o:p></span></b></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>const<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>BACKGROUND=6;<o:p></o:p></span></p><p class=MsoNormal><span style=mso-spacerun:yes>  </span>TIMER=16;</p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=mso-ansi-language:EN-US> isxbb_AddImage(Image: PChar; Flags: Cardinal): Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=mso-ansi-language:EN-US> 'isxbb_AddImage@files:isxbb.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=mso-ansi-language:EN-US> isxbb_Init(hWnd: Integer): Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external </span><span lang=EN-US style=mso-ansi-language:EN-US>'isxbb_Init@files:isxbb.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function</span><span lang=EN-US style=mso-ansi-language:EN-US> isxbb_StartTimer(Seconds: Integer; Flags: Cardinal): Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=mso-ansi-language:EN-US> 'isxbb_StartTimer@files:isxbb.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>function </span><span lang=EN-US style=mso-ansi-language:EN-US>isxbb_KillTimer(Flags: Cardinal): Integer;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>external</span><span lang=EN-US style=mso-ansi-language:EN-US> 'isxbb_KillTimer@files:isxbb.dll stdcall';<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>InitializeWizard</b>();<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>ExtractTemporaryFile('1.jpg');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>isxbb_AddImage(ExpandConstant('{tmp}')+'\1.jpg',BACKGROUND);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span>isxbb_Init(StrToInt(ExpandConstant('{hwnd}')));<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>end</span><span lang=EN-US style=mso-ansi-language:EN-US>;<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>procedure</span><span lang=EN-US style=mso-ansi-language:EN-US> <b style='mso-bidi-font-weight:
normal'>CurStepChanged</b>(CurStep: TSetupStep);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//В начале этапа установки запускаем слайд-шоу</span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes> </span></span><span lang=EN-US style='color:blue;
mso-ansi-language:EN-US'>if</span><span lang=EN-US style='mso-ansi-language:
EN-US'> CurStep=ssInstall<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>then<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>begin<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>ExtractTemporaryFile('2.jpg');<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>ExtractTemporaryFile('3.jpg');</span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>ExtractTemporaryFile('</span>4<span lang=EN-US style=mso-ansi-language:EN-US>.jpg');</span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>isxbb_AddImage(ExpandConstant('{tmp}')+'\2.jpg',BACKGROUND <span style=color:blue>or</span> TIMER);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>isxbb_AddImage(ExpandConstant('{tmp}')+'\3.jpg',BACKGROUND <span style=color:blue>or</span> TIMER);</span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>isxbb_AddImage(ExpandConstant('{tmp}')+'\4.jpg',BACKGROUND <span style=color:blue>or</span> TIMER);<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>isxbb_Init(StrToInt(ExpandConstant('{hwnd}')));</span></p><p class=MsoNormal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>//</span><span style=color:green>Таймер показа изображений, в секундах</span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US>isxbb_StartTimer(3,BACKGROUND)<o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=color:blue;mso-ansi-language:EN-US><span style=mso-spacerun:yes>  </span>end</span><span style=color:blue><o:p></o:p></span></p><p class=MsoNormal><span style=color:green>//На завершающем этапе останавливаем таймер, при этом возвращается фоновое изображение по умолчанию</span></p><p class=MsoNormal><span style=color:blue><span style=mso-spacerun:yes>  </span></span><span lang=EN-US style=color:blue;mso-ansi-language:EN-US>else if</span><span lang=EN-US style=mso-ansi-language:EN-US> CurStep=ssPostInstall <span style=color:blue>then</span><o:p></o:p></span></p><p class=MsoNormal><span lang=EN-US style=mso-ansi-language:EN-US><span style=mso-spacerun:yes>    </span></span>isxbb_KillTimer(BACKGROUND);</p><p class=MsoNormal><span style=color:blue>end</span>;</p><p class=MsoNormal><span style=color:green>Здесь указана неполная информация использования. В примерах использования </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style=color:green;mso-ansi-language:EN-US>isxbb</span><span style=color:green>.</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style=color:green;mso-ansi-language:EN-US>dll</span><span lang=EN-US style=color:green> </span></b><span style=color:green>можно еще посмотреть, как небольшие изображения подганять под разные углы фонового окна инсталлятора.</span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style=text-align:center><b style='mso-bidi-font-weight:
normal'><u><span style=color:black>ЗАКЛЮЧЕНИЕ<o:p></o:p></span></u></b></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><span style=color:black>Думаю, изучив данное руководство, вы решили для себя свои многие замыслы. Я рассказал обо всем, что знал, в отличие от некоторых жмотов, которые жалеют кусок своего кода или скрипта, считая, что они самые умные. Основательно поработав с данным инсталлятором, вы вряд ли перейдете на какой-нибудь другой. Для себя я сделал окончательный выбор – выбор за вами.<o:p></o:p></span></b></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><o:p>&nbsp;</o:p></b></p><p class=MsoNormal><b style=mso-bidi-font-weight:normal><o:p>&nbsp;</o:p></b></p><p class=MsoNormal align=center style='text-align:center;mso-outline-level:
1'><b><u><span style='font-size:20.0pt;font-family:"Verdana","sans-serif";
color:navy'>Благодарности</span></u></b><span style=color:navy><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>Огромную благодарность выражаю программисту </span><b><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;mso-ansi-language:EN-US'>ZUBR</span></b><b><span lang=EN-US style=font-size:10.0pt;font-family:"Verdana","sans-serif";color:black> </span></b><span style=font-size:10.0pt;font-family:"Verdana","sans-serif";color:black>за реализацию большинства описанных в этом руководстве примеров. Без его желания и согласия в помощи мне вряд ли удалось написать это руководство. Также спасибо </span><b style=mso-bidi-font-weight:normal><span lang=EN-US style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black;mso-ansi-language:EN-US'>Snake</span></b><span style=font-size:10.0pt;font-family:"Verdana","sans-serif";color:black>,<b style=mso-bidi-font-weight:normal> </b></span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;mso-ansi-language:EN-US'>Expeditor</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'> </span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>и<b style=mso-bidi-font-weight:normal> </b>многим ребятам из<b style=mso-bidi-font-weight:normal> </b></span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;mso-ansi-language:EN-US'>RU</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>-</span></b><b style=mso-bidi-font-weight:normal><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;mso-ansi-language:EN-US'>Board</span></b><span lang=EN-US style=font-size:10.0pt;font-family:"Verdana","sans-serif";color:black> </span><span style=font-size:10.0pt;font-family:"Verdana","sans-serif";color:black>за реализацию некоторых примеров и за предложенные идеи.</span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>Отдельную благодарность выражаю </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black;mso-ansi-language:EN-US'>BioCyborG</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'> </span></b><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>(</span><a href=http://biocyborg.narod.ru/>http://biocyborg.narod.ru</a><span style=color:green>, </span><a href=http://biocyborg.cjb.net/><span lang=EN-US style=mso-ansi-language:EN-US>http</span>://<span lang=EN-US style=mso-ansi-language:EN-US>biocyborg</span>.<span lang=EN-US style=mso-ansi-language:EN-US>cjb</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>net</span></a><span style=color:green>, </span><a href=http://biocyborg.tk/><span lang=EN-US style=mso-ansi-language:EN-US>http</span>://<span lang=EN-US style=mso-ansi-language:EN-US>biocyborg</span>.<span lang=EN-US style=mso-ansi-language:EN-US>tk</span></a><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif";color:black'>)</span><span style='color:
green'> </span><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>за осуществление моей давней мечты – проигрывание трекерной музыки через инсталлятор.</span><span style=color:green><o:p></o:p></span></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:black'>Особая благодарность <b>Александровой Марии</b>, которая перевела справочник на русский язык и составила документацию для начинающих. По ее работам я также учился. (За перевод справки отдельный поклон, т.к. сам знаю какого их переводить). Справку и последнюю версию данного руководства можно скачать с форума </span><a href=http://forum.ru-board.com/><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";mso-ansi-language:
EN-US'>http</span><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">://</span><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
mso-ansi-language:EN-US'>forum</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif"'>.</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Verdana","sans-serif";mso-ansi-language:EN-US'>ru</span><span style=font-size:10.0pt;font-family:"Verdana","sans-serif">-</span><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
mso-ansi-language:EN-US'>board</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif"'>.</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Verdana","sans-serif";mso-ansi-language:EN-US'>com</span></a><span style=font-size:10.0pt;font-family:"Verdana","sans-serif";color:black> в разделе <b style=mso-bidi-font-weight:normal>Программы </b>в соответствующей теме.<o:p></o:p></span></p><p class=MsoNormal>&nbsp;</p><p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:blue;mso-ansi-language:EN-US'>Copyright ©</span><span lang=EN-US style=font-size:10.0pt;font-family:"Verdana","sans-serif";color:blue> </span><span lang=EN-US style='font-size:10.0pt;font-family:"Verdana","sans-serif";
color:blue;mso-ansi-language:EN-US'>2003-2006, Kindly. All Rights Reserved.<o:p></o:p></span></p></div></body></html>