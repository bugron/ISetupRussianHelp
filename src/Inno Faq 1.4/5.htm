<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>Место на диске</title><link rel="stylesheet" type="text/css" href="css.css"> <script type="text/javascript" src="includer.js"></script></head><body><div id="heading"><h1>» Inno Setup Faq. Место на диске</h1></div><br>

<blockquote><td class="code"><script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTM">;;#Define NeedSize 5000<br>;;Если у вас архивы FreeArc, то сдесь укажите сколько необходимо места в Мб<br>;;Иначе просто закоментируйте строку<br>;;Автор: Shegorat<br>[Setup]<br>AppName=My Program<br>AppVerName=My Program v 1.5<br>DefaultDirName={pf}\My Program<br>DisableFinishedPage=yes<br>OutputDir=.<br>Compression=lzma/ultra<br>InternalCompressLevel=ultra<br>SolidCompression=yes<br><br>[Languages]<br>Name: ENG; MessagesFile: &quot;compiler:Default.isl&quot;<br>Name: RUS; MessagesFile: &quot;compiler:Languages\Russian.isl&quot;<br><br>[Files]<br>Source: {win}\help\*.hlp; DestDir: {app}\Files; Flags: external<br><br>[CustomMessages]<br>RUS.FreeSpace=Доступно места на диске:<br>RUS.NeedSpace=Требуется места на диске:<br>ENG.FreeSpace=Free space on disk:<br>ENG.NeedSpace=Need space on disk:<br><br>[Code]<br>var<br>NeedSpaceLabel,FreeSpaceLabel: TLabel;<br>FreeMB, TotalMB: Cardinal;<br>SizeStr: String;<br>SizeInt: Integer;<br>SymbolNumber: Integer;<br><br>function NumToStr(Float: Extended): String;<br>Begin<br>Result:= Format('%.2n', [Float]); StringChange(Result, ',', '.');<br>while ((Result[Length(Result)] = '0') or (Result[Length(Result)] = '.')) and (Pos('.', Result) &gt; 0) do<br>SetLength(Result, Length(Result)-1);<br>end;<br><br>function GetSize(): Integer;<br>begin<br>SizeStr:= WizardForm.DiskSpaceLabel.Caption;<br>for SymbolNumber:= 97 to 122 do begin<br>while (Pos(Chr(SymbolNumber), SizeStr) &gt; 0) do Delete(SizeStr, Pos(Chr(SymbolNumber), SizeStr),1); ///Находим все символы нижнего регистра и удаляем<br>while (Pos(AnsiUppercase(Chr(SymbolNumber)), SizeStr) &gt; 0) do Delete(SizeStr, Pos(AnsiUppercase(Chr(SymbolNumber)), SizeStr),1); end; ///Находим все символы верхнего регистра и удаляем<br>for SymbolNumber:= 192 to 255 do begin<br>while (Pos(Chr(SymbolNumber), SizeStr) &gt; 0) do Delete(SizeStr, Pos(Chr(SymbolNumber), SizeStr),1); end; ///Находим все символы нижнего регистра и удаляем<br>while (Pos('.', SizeStr) &gt; 0) do Delete(SizeStr, Pos('.', SizeStr), 1) ///Удаляем точки<br>Delete(SizeStr, Pos(',', SizeStr), 5) ///Удаляем дробную часть<br>Result:= StrToInt(Trim(SizeStr)); ///Переводим в число<br>end;<br><br>function CompareNum(FirstNum, SecondNum: Integer): Boolean;<br>begin<br>if FirstNum &lt; SecondNum then Result:= False else Result:= True;<br>end;<br><br>function MbOrTb(Byte: Extended): String;<br>begin<br>if Byte &lt; 1024 then Result:= NumToStr(Byte) + ' Мб' else<br>if Byte/1024 &lt; 1024 then Result:= NumToStr(round(Byte/1024*100)/100) + ' Гб' else<br>Result:= NumToStr(round((Byte/(1024*1024))*100)/100) + ' Тб'<br>end;<br><br>procedure GetFreeSpaceCaption(Sender: TObject);<br>var Path: String;<br>begin<br>Path := ExtractFileDrive(WizardForm.DirEdit.Text);<br>GetSpaceOnDisk(Path, True, FreeMB, TotalMB);<br>FreeSpaceLabel.Caption:= ExpandConstant('{cm:FreeSpace}') + MbOrTb(FreeMB)<br>NeedSpaceLabel.Caption := ExpandConstant('{cm:NeedSpace}') + MbOrTb(SizeInt)<br>if WizardForm.CurPageID = wpSelectDir then begin<br>WizardForm.NextButton.Enabled:= CompareNum(FreeMB, SizeInt)<br>end;<br>end;<br><br>procedure InitializeWizard();<br>begin<br>WizardForm.DiskSpaceLabel.Hide;<br>#ifdef NeedSize<br>SizeInt:= {#NeedSize}<br>#else<br>SizeInt:= GetSize;<br>#endif<br><br>NeedSpaceLabel := TLabel.Create(WizardForm);<br>NeedSpaceLabel.SetBounds(ScaleX(0), ScaleY(198), ScaleX(209), ScaleY(13))<br>NeedSpaceLabel.Parent := WizardForm.SelectDirPage;<br>NeedSpaceLabel.Transparent:=true;<br><br>FreeSpaceLabel := TLabel.Create(WizardForm);<br>FreeSpaceLabel.SetBounds(ScaleX(0), ScaleY(216), ScaleX(209), ScaleY(13))<br>FreeSpaceLabel.Parent := WizardForm.SelectDirPage;<br>FreeSpaceLabel.Transparent:=true;<br><br>WizardForm.DirEdit.OnChange:= @GetFreeSpaceCaption;<br>WizardForm.DirEdit.Text:= WizardForm.DirEdit.Text + #0;<br>end;<br><br>procedure CurPageChanged(CurPageID: Integer);<br>begin<br>if CurPageID = wpSelectDir then begin<br>GetFreeSpaceCaption(nil)<br>end;<br>end;<br>
</code></td><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTM','delphi');</script></blockquote>

<br>Способ 2: 

<blockquote><td class="code"><script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTN">[Setup]<br>AppName=NeedSize<br>AppVerName=NeedSize<br>DefaultDirName={pf}\NeedSize<br><br>[Code]<br>const<br>NeedSize = 9700;<br><br>var<br>FreeMb, TotalMB: Cardinal;<br>NeedSpaceLabel,FreeSpaceLabel: TLabel;<br><br>procedure GetFreeSpaceCaption( Sender: TObject);<br>var<br>Path: String;<br>begin<br>Path := ExtractFileDrive(WizardForm.DirEdit.Text);<br>GetSpaceOnDisk(Path, True, FreeMB, TotalMB);<br>if FreeMB &gt; 1024 then<br>FreeSpaceLabel.Caption := 'Свободно на выбранном диске: ' + FloatToStr(round(FreeMB/1024*100)/100) + ' GB'<br>else<br>FreeSpaceLabel.Caption := 'Свободно на выбранном диске: ' + IntToStr(FreeMB)+ ' MB';<br>begin<br>if FreeMB &lt; NeedSize then<br>begin<br>WizardForm.NextButton.Enabled:=false;<br>end else<br>WizardForm.NextButton.Enabled:=true;<br>end;<br>end;<br><br>procedure InitializeWizard();<br>begin<br>WizardForm.DiskSpaceLabel.Hide;<br><br>NeedSpaceLabel := TLabel.Create(WizardForm);<br>with NeedSpaceLabel do<br>begin<br>Parent := WizardForm.SelectDirPage;<br>Left := ScaleX(0);<br>Top := ScaleY(198);<br>Width := ScaleX(209);<br>Height := ScaleY(13);<br>Caption := 'Требуется для установки: 9 GB';<br>end;<br><br>FreeSpaceLabel := TLabel.Create(WizardForm);<br>with FreeSpaceLabel do<br>begin<br>Parent := WizardForm.SelectDirPage;<br>Left := ScaleX(0);<br>Top := ScaleY(216);<br>Width := ScaleX(209);<br>Height := ScaleY(13);<br>end;<br><br>WizardForm.DirEdit.OnChange := @GetFreeSpaceCaption;<br>WizardForm.DirEdit.Text := WizardForm.DirEdit.Text + #0;<br>end;<br><br>procedure CurPageChanged(CurPageID: Integer);<br>begin<br>if CurPageID = wpSelectDir then<br>if FreeMB &lt; NeedSize then<br>begin<br>WizardForm.NextButton.Enabled:=False<br>end;<br>end;
</code></td><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTN','delphi');</script></blockquote>

<br>Вариант 2: 

<blockquote><td class="code"><script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTB">#define NeedSize &quot;500427&quot;<br>#define TotalNeedSize &quot;500427&quot;<br><br>[Setup]<br>AppName=NeedSize<br>AppVerName=TotalNeedSize<br>DefaultDirName={pf}\NeedSize<br>DefaultGroupName=NeedSize<br><br>[Code]<br>///******************************************* [Место для установки ] ***************************************************///<br><br>function NumToStr(Float: Extended): String;<br>Begin<br>Result:= Format('%.2n', [Float]); StringChange(Result, ',', '.');<br>while ((Result[Length(Result)] = '0') or (Result[Length(Result)] = '.')) and (Pos('.', Result) &gt; 0) do<br>SetLength(Result, Length(Result)-1);<br>end;<br><br>var<br>FreeMB, TotalMB: Cardinal;<br>NeedSize, TotalNeedSize:Integer; TotalNeedSpaceLabel,NeedSpaceLabel,FreeSpaceLabel: TLabel;<br><br>function MbOrTb(Byte: Extended): String;<br>begin<br>if Byte &lt; 1024 then Result:= NumToStr(Byte) + ' Мб' else<br>if Byte/1024 &lt; 1024 then Result:= NumToStr(round(Byte/1024*100)/100) + ' Гб' else<br>Result:= NumToStr(round((Byte/(1024*1024))*100)/100) + ' Тб';<br>end;<br><br>procedure GetFreeSpaceCaption(Sender: TObject);<br>var<br>Path: String;<br>begin<br>Path := ExtractFileDrive(WizardForm.DirEdit.Text);<br>GetSpaceOnDisk(Path, True, FreeMB, TotalMB);<br>NeedSpaceLabel.Caption := 'Игра займет на диске: '+ MbOrTb(NeedSize);<br>TotalNeedSpaceLabel.Caption := 'Для распаковки требуется: '+ MbOrTb(TotalNeedSize);<br>FreeSpaceLabel.Caption := 'Доступно места на диске: '+ MbOrTb(FreeMB);<br>WizardForm.NextButton.Enabled:= (FreeMB&gt;TotalNeedSize);<br>WizardForm.NextButton.Enabled:= (FreeMB&gt;NeedSize);<br>if (FreeMB&lt;TotalNeedSize) then<br>FreeSpaceLabel.Font.Color:=clRed else<br>FreeSpaceLabel.Font.Color:=clBlack;<br>if (FreeMB&lt;NeedSize) then<br>FreeSpaceLabel.Font.Color:=clRed else<br>FreeSpaceLabel.Font.Color:=clBlack;<br>end;<br><br>procedure InitializeWizard();<br>begin<br>NeedSize := {#NeedSize};<br>TotalNeedSize := {#TotalNeedSize};<br><br>WizardForm.DiskSpaceLabel.Hide;<br><br>TotalNeedSpaceLabel := TLabel.Create(WizardForm);<br>TotalNeedSpaceLabel.Parent := WizardForm.SelectDirPage;<br>TotalNeedSpaceLabel.SetBounds(ScaleX(5), ScaleY(200), ScaleX(209), ScaleY(13));<br><br>FreeSpaceLabel := TLabel.Create(WizardForm);<br>FreeSpaceLabel.Parent := WizardForm.SelectDirPage;<br>FreeSpaceLabel.SetBounds(ScaleX(5), ScaleY(180), ScaleX(209), ScaleY(13));<br><br>NeedSpaceLabel := TLabel.Create(WizardForm);<br>NeedSpaceLabel.Parent := WizardForm.SelectDirPage;<br>NeedSpaceLabel.SetBounds(ScaleX(5), ScaleY(220), ScaleX(209), ScaleY(13));<br><br>WizardForm.DirEdit.OnChange := @GetFreeSpaceCaption;<br>end;<br><br>///******************************************* [ конец Место для установки ] ***************************************************///<br><br>procedure CurPageChanged(CurPageID: Integer);<br>begin<br>if CurPageID = wpSelectDir then GetFreeSpaceCaption(nil);<br>end;
</code></td><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTB','delphi');</script></blockquote>

<br><div id="heading"><h1><font size="1" face="Consolas">Copyright (c) <a href="http://www.krinkels.org/" target="_blank">Krinkels Inc</a></font></h1></div></body></html>