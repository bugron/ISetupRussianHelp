<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>Проигрывание 2-3 песен во время установки</title><link rel="stylesheet" type="text/css" href="css.css"><script type="text/javascript" src="includer.js"></script><script language='jscript' type='text/javascript' src='copycode.js'></script></head><body><div id="heading"><h1>» Inno Setup Faq. Проигрывание 2-3 песен во время установки</h1></div><br><script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTM"> <input type="button" value="Копировать в буфер обмена" onClick="copyToClipboard( taCode1, theCode1 );"> <blockquote id="theCode1"><font>[Setup]<br>AppName=My Program<br>AppVerName=My Program 1.5<br>DefaultDirName={pf}\My Program<br><br>[Languages]<br>Name: &quot;russian&quot;; MessagesFile: &quot;compiler:Languages\Russian.isl&quot;<br><br>[Files]<br>Source: &quot;bass.dll&quot;; DestDir: {tmp}; Flags: ignoreversion dontcopy nocompression<br>Source: &quot;innocallback.dll&quot;; DestDir: {tmp}; Flags: ignoreversion dontcopy nocompression<br>Source: &quot;D:\Мои файлы\Музыка\Сектор газовой атаки\10 До первой крови\01-Наготове.mp3&quot;; DestDir: {tmp}; Flags: ignoreversion dontcopy nocompression<br>Source: &quot;D:\Мои файлы\Музыка\Сектор газовой атаки\10 До первой крови\02-Дурная любовь.mp3&quot;; DestDir: {tmp}; Flags: ignoreversion dontcopy nocompression<br><br>[Code]<br>type<br>&nbsp; HSTREAM=DWORD;<br>&nbsp; TTimerProc=procedure(uTimerID,uMessage:UINT;dwUser,dw1,dw2:DWORD);<br>var<br>&nbsp; MP3List:TStringList;<br>&nbsp; CurrentMP3:integer;<br>&nbsp; hMP3:HWND;<br>&nbsp; TimerID:LongWord;<br><br>function SetTimer(hWnd:HWND;nIDEvent,uElapse:UINT;lpTimerFunc:LongWord{{TFNTimerProc}):UINT;&nbsp; external 'SetTimer@user32.dll stdcall delayload';<br>function KillTimer(hWnd:HWND;uIDEvent:UINT):BOOL; external 'KillTimer@user32.dll stdcall delayload';<br>function BASS_ChannelIsActive(Handle:HWND):DWORD; external 'BASS_ChannelIsActive@files:bass.dll stdcall';<br>function BASS_SetConfig(Option,Value:DWORD):DWORD; external 'BASS_SetConfig@files:bass.dll stdcall';<br>function BASS_Init(Device:integer;Freq,Flags:DWORD;Win:HWND;CLSID:integer):boolean; external 'BASS_Init@files:bass.dll stdcall delayload';<br>function BASS_StreamCreateFile(Mem:BOOL;f:PChar;Offset:DWORD;Length:DWORD;Flags:DWORD):HSTREAM; external 'BASS_StreamCreateFile@files:bass.dll stdcall';<br>function BASS_StreamFree(Handle:HWND):boolean; external 'BASS_StreamFree@files:bass.dll stdcall';<br>function BASS_ChannelPlay(Handle:HWND;Restart:boolean):boolean; external 'BASS_ChannelPlay@files:bass.dll stdcall';<br>function BASS_Start: Boolean; external 'BASS_Start@files:bass.dll stdcall';<br>function BASS_Stop: Boolean; external 'BASS_Stop@files:bass.dll stdcall';<br>function BASS_Free: Boolean; external 'BASS_Free@files:bass.dll stdcall delayload';<br>function WrapTimerProc(CallBack:TTimerProc;ParamCount:integer):LongWord; external 'wrapcallback@files:innocallback.dll stdcall';<br><br>procedure TimerTick(uTimerID,uMessage:UINT;dwUser,dw1,dw2:DWORD);<br>begin<br>&nbsp; if BASS_ChannelIsActive(hMP3)=0 then begin<br>&nbsp; &nbsp; BASS_Stop;<br>&nbsp; &nbsp; BASS_StreamFree(hMP3);<br>&nbsp; &nbsp; hMP3:=BASS_StreamCreateFile(False,PChar(MP3List.Strings[CurrentMP3]),0,0,0);<br>&nbsp; &nbsp; BASS_Start;<br>&nbsp; &nbsp; if hMP3&lt;&gt;0 then<br>&nbsp; &nbsp; &nbsp; if BASS_ChannelPlay(hMP3,True) then begin<br>&nbsp; &nbsp; &nbsp; &nbsp; CurrentMP3:=CurrentMP3+1;<br>&nbsp; &nbsp; &nbsp; &nbsp; if CurrentMP3&gt;MP3List.Count-1 then CurrentMP3:=0;<br>&nbsp; &nbsp; &nbsp; end;<br>&nbsp; end;<br>end;<br><br>function InitializeSetup:boolean;<br>begin<br>&nbsp; ExtractTemporaryFile('01-Наготове.mp3');<br>&nbsp; ExtractTemporaryFile('02-Дурная любовь.mp3');<br>&nbsp; MP3List:=TStringList.Create;<br>&nbsp; MP3List.Add(ExpandConstant('{tmp}')+'\01-Наготове.mp3');<br>&nbsp; MP3List.Add(ExpandConstant('{tmp}')+'\02-Дурная любовь.mp3');<br>&nbsp; CurrentMP3:=0;<br>&nbsp; Result:=True;<br>end;<br><br>procedure InitializeWizard;<br>begin<br>&nbsp; TimerID:=SetTimer(0,0,500,WrapTimerProc(@TimerTick,5));<br>&nbsp; BASS_Init(-1,44100,0,0,0);<br>&nbsp; BASS_SetConfig(5,100);<br>&nbsp; BASS_SetConfig(6,100);<br>end;<br><br>procedure DeinitializeSetup;<br>begin<br>&nbsp; KillTimer(0,TimerID);<br>&nbsp; BASS_Stop;<br>&nbsp; BASS_Free;<br>&nbsp; MP3List.Free;<br>end;</font></blockquote><textarea id="taCode1" style="display:none;" rows="1" cols="5"></textarea><textarea id='taCode' style='display:none;' rows='1' cols='20'></textarea></code><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTM','delphi');</script><br><div id="heading"><h1><font size="1" face="Consolas">Copyright (c) <a href="http://www.krinkels.org/" target="_blank">Krinkels Inc</a></font></h1></div></body></html>