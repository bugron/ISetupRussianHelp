<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>Прозрачный инсталлятор</title><link rel="stylesheet" type="text/css" href="css.css">
<script language='jscript' type='text/javascript' src='copycode.js'></script>
<script type="text/javascript" src="includer.js"></script></head><body><div id="heading"><h1>» Inno Setup Faq. Прозрачный инсталлятор</h1></div><br>
<script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTM">
<input type="button" value="Копировать в буфер обмена" onClick="copyToClipboard( taCode1, theCode1 );">
<blockquote id="theCode1"><font>
///Win7Aero&nbsp;v1.0.1<br>
///created&nbsp;by&nbsp;troyan90&nbsp;01.2012<br>
<br>
///пример&nbsp;добавляющий&nbsp;эффект&nbsp;стекла&nbsp;для&nbsp;инсталлятора<br>
///стекло&nbsp;работает&nbsp;в&nbsp;Win&nbsp;7&nbsp;и&nbsp;выше.<br>
///в&nbsp;хр/vista&nbsp;пропускается&nbsp;загрузка&nbsp;стекла(проблем&nbsp;с&nbsp;использованием&nbsp;инсталлятора&nbsp;в&nbsp;хр&nbsp;не&nbsp;будет)<br>
///скрипт&nbsp;совместим&nbsp;с&nbsp;расширенной&nbsp;версией&nbsp;Inno&nbsp;Setup<br>
<br>
///протестировано&nbsp;на:&nbsp;Windows&nbsp;xp/vista/7<br>
<br>
[Setup]<br>
AppName=Win7Aero&nbsp;v1.0.1<br>
AppVerName=Win7Aero&nbsp;v1.0.1<br>
OutputDir=.<br>
CreateAppDir=no<br>
CreateUninstallRegKey=no<br>
#ifdef&nbsp;UNICODE<br>
OutputBaseFilename=Win7Aerov1.0.1(u)<br>
#else<br>
OutputBaseFilename=Win7Aerov1.0.1<br>
#endif<br>
<br>
[Languages]<br>
Name:&nbsp;&quot;ru&quot;;&nbsp;MessagesFile:&nbsp;&quot;compiler:Languages\Russian.isl&quot;;<br>
<br>
[Messages]<br>
ru.ButtonBack=«&nbsp;Назад<br>
ru.ButtonNext=Далее&nbsp;»<br>
ru.ButtonInstall=Установить<br>
ru.ButtonCancel=Отмена<br>
<br>
[code]<br>
type<br>
&nbsp;&nbsp;_TMargins&nbsp;=&nbsp;record<br>
&nbsp;&nbsp;&nbsp;&nbsp;cxLeftWidth:&nbsp;Integer;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cxRightWidth:&nbsp;Integer;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cyTopHeight:&nbsp;Integer;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cyBottomHeight:&nbsp;Integer;<br>
&nbsp;&nbsp;end;<br>
<br>
var<br>
&nbsp;&nbsp;_atimer:array&nbsp;of&nbsp;ttimer;_count,_btncount:integer;_oldproc:&nbsp;Longint;_btnspase:array&nbsp;of&nbsp;TNewStaticText;<br>
&nbsp;&nbsp;_form:array&nbsp;of&nbsp;TSetupForm;_margins:array&nbsp;of&nbsp;_TMargins;_speedbutton:array&nbsp;of&nbsp;TNewSpeedButton;_button:array&nbsp;of&nbsp;TNewButton;<br>
<br>
function&nbsp;_DwmExtendFrameIntoClientArea(destWnd:&nbsp;HWND;&nbsp;const&nbsp;pMarInset:&nbsp;_TMargins):&nbsp;Longint;&nbsp;external&nbsp;'DwmExtendFrameIntoClientArea@dwmapi.dll&nbsp;stdcall&nbsp;delayload';<br>
function&nbsp;_CallWindowProc(lpPrevWndFunc:&nbsp;Longint;&nbsp;hWnd:&nbsp;HWND;&nbsp;Msg:&nbsp;UINT;&nbsp;wParam,&nbsp;lParam:&nbsp;Longint):&nbsp;Longint;&nbsp;external&nbsp;'CallWindowProcA@user32.dll&nbsp;stdcall&nbsp;delayload';<br>
function&nbsp;_SetWindowLong(hWnd:&nbsp;HWND;&nbsp;nIndex:&nbsp;Integer;&nbsp;dwNewLong:&nbsp;Longint):&nbsp;Longint;&nbsp;external&nbsp;'SetWindowLongA@user32.dll&nbsp;stdcall&nbsp;delayload';<br>
<br>
function&nbsp;_DwmIsCompositionEnabled:&nbsp;boolean;<br>
var<br>
&nbsp;&nbsp;r:&nbsp;dword;<br>
begin<br>
&nbsp;&nbsp;if&nbsp;RegValueExists(HKEY_CURRENT_USER,&nbsp;'Software\Microsoft\Windows\DWM',&nbsp;'Composition')&nbsp;then&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;RegQueryDWordValue(HKEY_CURRENT_USER,&nbsp;'Software\Microsoft\Windows\DWM',&nbsp;'Composition',&nbsp;r);<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;r&nbsp;=&nbsp;1&nbsp;then&nbsp;result:=true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;r&nbsp;=&nbsp;0&nbsp;then&nbsp;result:=false;<br>
&nbsp;&nbsp;end<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;result:=false;<br>
end;<br>
<br>
function&nbsp;_isWin7:&nbsp;boolean;<br>
var<br>
&nbsp;&nbsp;ver:&nbsp;TWindowsVersion;<br>
begin<br>
&nbsp;&nbsp;GetWindowsVersionEx(ver);<br>
&nbsp;&nbsp;if&nbsp;((ver.Major&nbsp;=&nbsp;6)&nbsp;and&nbsp;(ver.Minor&nbsp;&gt;&nbsp;0))&nbsp;or&nbsp;(ver.Major&nbsp;&gt;&nbsp;6)&nbsp;then&nbsp;result:=true<br>
&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;result:=false;<br>
end;<br>
<br>
procedure&nbsp;_ATime(Sender:&nbsp;TObject);&nbsp;var&nbsp;i:integer;<br>
begin<br>
&nbsp;&nbsp;i:=TTimer(Sender).Tag;<br>
&nbsp;&nbsp;_DwmExtendFrameIntoClientArea(_form[i].Handle,&nbsp;_margins[i]);<br>
&nbsp;&nbsp;_atimer[i].Enabled:=false;<br>
end;<br>
<br>
procedure&nbsp;AddGlass(Form:TSetupForm;Left,Top,Right,Bottom:Integer);<br>
begin<br>
&nbsp;&nbsp;if&nbsp;_isWin7&nbsp;then&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLength(_atimer,&nbsp;_count+1);&nbsp;SetArrayLength(_margins,&nbsp;_count+1);&nbsp;SetArrayLength(_form,&nbsp;_count+1);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;_DwmIsCompositionEnabled&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form.Color:=clBackground;<br>
&nbsp;&nbsp;&nbsp;&nbsp;_form[_count]:=form;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_margins[_count].cxLeftWidth:=Left;<br>
&nbsp;&nbsp;&nbsp;&nbsp;_margins[_count].cxRightWidth:=Right;<br>
&nbsp;&nbsp;&nbsp;&nbsp;_margins[_count].cyTopHeight:=Top;<br>
&nbsp;&nbsp;&nbsp;&nbsp;_margins[_count].cyBottomHeight:=Bottom;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_atimer[_count]:=TTimer.Create(nil);<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;_atimer[_count]&nbsp;do&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Interval:=1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tag:=_count;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnTimer:=@_ATime;<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_count:=_count+1;<br>
&nbsp;&nbsp;end;<br>
end;<br>
<br>
function&nbsp;_FProc(h:&nbsp;hwnd;&nbsp;Msg,&nbsp;wParam,&nbsp;lParam:&nbsp;Longint):&nbsp;Longint;&nbsp;var&nbsp;c,i:integer;<br>
begin<br>
&nbsp;&nbsp;case&nbsp;msg&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;$031E:&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;_DwmIsCompositionEnabled&nbsp;then&nbsp;c:=clBackground<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;c:=clWindow;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i:=0&nbsp;to&nbsp;(_count-1)&nbsp;do&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_form[i].Color:=c;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_atimer[i].Enabled:=true;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;Result:=_CallWindowProc(_oldproc,&nbsp;h,&nbsp;Msg,&nbsp;wParam,&nbsp;lParam);<br>
end;<br>
<br>
procedure&nbsp;UpdateGlass;<br>
begin<br>
&nbsp;&nbsp;if&nbsp;_isWin7&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;_oldproc:=_SetWindowLong(WizardForm.Handle,&nbsp;-4,&nbsp;CallbackAddr('_FProc'));<br>
end;<br>
<br>
procedure&nbsp;DelGlass;<br>
begin<br>
&nbsp;&nbsp;if&nbsp;_isWin7&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;_SetWindowLong(WizardForm.Handle,&nbsp;-4,&nbsp;_oldproc);<br>
end;<br>
<br>
procedure&nbsp;_btnClick(Sender:&nbsp;TObject);&nbsp;var&nbsp;i,n:integer;&nbsp;Button:&nbsp;TButton;<br>
begin<br>
&nbsp;&nbsp;i:=TNewSpeedButton(Sender).Tag;<br>
&nbsp;&nbsp;for&nbsp;n:=0&nbsp;to&nbsp;(_btncount&nbsp;-&nbsp;1)&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;=&nbsp;n&nbsp;then&nbsp;Button:=&nbsp;_button[n];<br>
&nbsp;&nbsp;Button.OnClick(Button);<br>
end;<br>
<br>
procedure&nbsp;AddButton(Button:TNewButton);<br>
begin<br>
&nbsp;&nbsp;if&nbsp;_isWin7&nbsp;then&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;SetArrayLength(_button,&nbsp;_btncount+1);&nbsp;SetArrayLength(_btnspase,&nbsp;_btncount+1);&nbsp;SetArrayLength(_speedbutton,&nbsp;_btncount+1);<br>
&nbsp;&nbsp;&nbsp;&nbsp;_button[_btncount]:=Button;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_btnspase[_btncount]:=TNewStaticText.Create(Button.Parent);<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;_btnspase[_btncount]&nbsp;do&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Parent:=Button.Parent;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ifdef&nbsp;UNICODE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;WizardForm.DoubleBuffered&nbsp;then&nbsp;Color:=clWindowFrame;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetBounds(ScaleX(Button.Left&nbsp;+&nbsp;1),&nbsp;ScaleY(Button.Top&nbsp;+&nbsp;1),&nbsp;ScaleX(Button.Width&nbsp;-&nbsp;2),&nbsp;ScaleY(Button.Height&nbsp;-&nbsp;2));<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_speedbutton[_btncount]:=TNewSpeedButton.Create(_btnspase[_btncount]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;_speedbutton[_btncount]&nbsp;do&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Parent:=_btnspase[_btncount];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tag:=_btncount;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Caption:=Button.Caption;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetBounds(ScaleX(-1),&nbsp;ScaleY(-1),&nbsp;ScaleX(Button.Width),&nbsp;ScaleY(Button.Height));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnClick:=@_btnClick;<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Button.Width:=0;&nbsp;Button.Height:=0;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_btncount:=_btncount+1;<br>
&nbsp;&nbsp;end;<br>
end;<br>
<br>
procedure&nbsp;UpdateBtn;&nbsp;var&nbsp;i:integer;<br>
begin<br>
&nbsp;&nbsp;if&nbsp;_isWin7&nbsp;then&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i:=0&nbsp;to&nbsp;(_btncount&nbsp;-&nbsp;1)&nbsp;do&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_speedbutton[i].Caption:=_button[i].Caption;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_btnspase[i].Visible:=_button[i].Visible;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_speedbutton[i].Enabled:=_button[i].Enabled;<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
end;<br>
<br>
procedure&nbsp;InitializeWizard();<br>
begin<br>
&nbsp;&nbsp;AddGlass(WizardForm,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;47);<br>
&nbsp;&nbsp;///AddGlass(MainForm,&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;47);<br>
&nbsp;&nbsp;UpdateGlass;<br>
<br>
&nbsp;&nbsp;AddButton(WizardForm.CancelButton);<br>
&nbsp;&nbsp;AddButton(WizardFOrm.NextButton);<br>
&nbsp;&nbsp;AddButton(WizardFOrm.BackButton);<br>
end;<br>
<br>
procedure&nbsp;CurPageChanged(CurPageID:&nbsp;Integer);<br>
begin<br>
&nbsp;&nbsp;UpdateBtn;<br>
end;<br>
<br>
procedure&nbsp;DeinitializeSetup();<br>
begin<br>
&nbsp;&nbsp;DelGlass;<br>
end;<br>
</font></blockquote><textarea id="taCode1" style="display:none;" rows="1" cols="5"></textarea><textarea id='taCode' style='display:none;' rows='1' cols='20'></textarea></code><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTM','delphi');</script><br><div id="heading"><h1><font size="1" face="Consolas">Copyright (c) <a href="http://www.krinkels.org/" target="_blank">Krinkels Inc</a></font></h1></div></body></html>