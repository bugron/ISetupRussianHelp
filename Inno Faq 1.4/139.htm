<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>Улучшенный деинсталлятор 2</title><link rel="stylesheet" type="text/css" href="css.css">
<script language='jscript' type='text/javascript' src='copycode.js'></script>
<script type="text/javascript" src="includer.js"></script></head><body><div id="heading"><h1>» Inno Setup Faq. Улучшенный деинсталлятор 2</h1></div><br>
<script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTM">
<input type="button" value="Копировать в буфер обмена" onClick="copyToClipboard( taCode1, theCode1 );">
<blockquote id="theCode1"><font>
[Setup]<br>
AppName=My&nbsp;Program<br>
AppVerName=My&nbsp;Program&nbsp;v.1.2<br>
DefaultDirName={pf}\My&nbsp;Program<br>
DirExistsWarning=no<br>
<br>
[Files]<br>
;;Source:&nbsp;Files\*;&nbsp;DestDir:&nbsp;{app}<br>
<br>
[Code]<br>
var&nbsp;StaticText:&nbsp;TNewStaticText;&nbsp;InvertButton:&nbsp;TButton;&nbsp;DelAllReadOnly,&nbsp;SkipAllReadOnly:&nbsp;Boolean;&nbsp;Form,&nbsp;MsgForm:&nbsp;TSetupForm;&nbsp;CheckListBox:&nbsp;TNewCheckListBox;&nbsp;AllButton,&nbsp;UnAllButton,&nbsp;CancelButton,&nbsp;DelButton,&nbsp;MsgAllButton,&nbsp;MsgSkipAllButton,&nbsp;MsgCancelButton,&nbsp;MsgDelButton:&nbsp;TButton;<br>
const&nbsp;oneMB=&nbsp;1024*1024;&nbsp;bidDelAll&nbsp;=&nbsp;7;&nbsp;bidSkipAll&nbsp;=&nbsp;8;<br>
<br>
function&nbsp;ByteOrTB(Bytes:&nbsp;Extended;&nbsp;noMB:&nbsp;Boolean):&nbsp;string;&nbsp;{{Перевод&nbsp;числа&nbsp;в&nbsp;значение&nbsp;бт/Кб/Мб/Гб/Тб&nbsp;(до&nbsp;3х&nbsp;знаков&nbsp;после&nbsp;запятой)}<br>
Begin<br>
if&nbsp;noMB&nbsp;then&nbsp;begin<br>
if&nbsp;Bytes&nbsp;&lt;&nbsp;1024&nbsp;then&nbsp;Result:=&nbsp;FloatToStr(Int(Bytes))+&nbsp;'&nbsp;Бт'<br>
else<br>
if&nbsp;Bytes/1024&nbsp;&lt;&nbsp;1024&nbsp;then&nbsp;Result:=&nbsp;FloatToStr(round((Bytes/1024)*10)/10)&nbsp;+&nbsp;'&nbsp;Кб'<br>
else<br>
If&nbsp;Bytes/oneMB&nbsp;&lt;&nbsp;1024&nbsp;then&nbsp;Result:=&nbsp;FloatToStr(round(Bytes/oneMB*100)/100)&nbsp;+&nbsp;'&nbsp;Мб'<br>
else<br>
If&nbsp;Bytes/oneMB/1000&nbsp;&lt;&nbsp;1024&nbsp;then&nbsp;Result:=&nbsp;FloatToStr(round(Bytes/oneMB/1024*1000)/1000)&nbsp;+&nbsp;'&nbsp;Гб'<br>
else<br>
Result:=&nbsp;FloatToStr(round(Bytes/oneMB/oneMB*1000)/1000)&nbsp;+&nbsp;'&nbsp;Тб'<br>
end&nbsp;else<br>
Result:=&nbsp;FloatToStr(Int(Bytes/oneMB))+&nbsp;'&nbsp;Мб';<br>
StringChange(Result,&nbsp;',',&nbsp;'.')<br>
end;<br>
<br>
function&nbsp;Size64(Hi,&nbsp;Lo:&nbsp;Integer):&nbsp;Extended;&nbsp;var&nbsp;i:&nbsp;Integer;&nbsp;Begin<br>
Result:=&nbsp;Lo;&nbsp;if&nbsp;Lo&lt;&nbsp;0&nbsp;then&nbsp;Result:=&nbsp;Result&nbsp;+&nbsp;$7FFFFFFF&nbsp;+&nbsp;$7FFFFFFF&nbsp;+&nbsp;2;<br>
for&nbsp;Hi:=&nbsp;Hi-1&nbsp;Downto&nbsp;0&nbsp;do&nbsp;Result:=&nbsp;Result&nbsp;+&nbsp;$7FFFFFFF&nbsp;+&nbsp;$7FFFFFFF&nbsp;+&nbsp;2;<br>
end;<br>
<br>
function&nbsp;FillListBox(const&nbsp;fromDir,&nbsp;fileMask:&nbsp;string;&nbsp;SubDirsAllow:&nbsp;Boolean;&nbsp;Level:&nbsp;Byte):&nbsp;Extended;&nbsp;var&nbsp;FSR,&nbsp;DSR:&nbsp;TFindRec;&nbsp;FindResult:&nbsp;Boolean;&nbsp;n:&nbsp;Integer;<br>
Begin<br>
<br>
if&nbsp;Level&nbsp;=&nbsp;1&nbsp;then&nbsp;begin<br>
CheckListBox.Items.Clear<br>
CheckListBox.AddCheckBox(fromDir,&nbsp;'',&nbsp;0,&nbsp;True,&nbsp;True,&nbsp;False,&nbsp;True,&nbsp;TStringList.Create);<br>
TStrings(CheckListBox.ItemObject[0]).Text:=&nbsp;fromDir;<br>
end;<br>
<br>
&nbsp;&nbsp;FindResult:=&nbsp;FindFirst(AddBackslash(fromDir)&nbsp;+&nbsp;fileMask,&nbsp;FSR);<br>
Try<br>
&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;FindResult&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;FSR.Attributes&nbsp;and&nbsp;FILE_ATTRIBUTE_DIRECTORY&nbsp;=&nbsp;0&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br>
&nbsp;&nbsp;{{files}&nbsp;n:=&nbsp;CheckListBox.AddCheckBox(FSR.Name,&nbsp;PADL(ByteOrTB(Size64(FSR.SizeHigh,&nbsp;FSR.SizeLow),&nbsp;true),&nbsp;9),&nbsp;Level,&nbsp;True,&nbsp;True,&nbsp;False,&nbsp;True,&nbsp;TStringList.Create);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TStrings(CheckListBox.ItemObject[n]).Text:=&nbsp;AddBackslash(fromDir)&nbsp;+&nbsp;FSR.Name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FindResult:=&nbsp;FindNext(FSR);<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FindResult&nbsp;:=&nbsp;FindFirst(AddBackslash(fromDir)&nbsp;+&nbsp;'*.*',&nbsp;DSR);<br>
while&nbsp;FindResult&nbsp;and&nbsp;SubDirsAllow&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((DSR.Attributes&nbsp;and&nbsp;FILE_ATTRIBUTE_DIRECTORY)&nbsp;=&nbsp;FILE_ATTRIBUTE_DIRECTORY)&nbsp;and&nbsp;not&nbsp;((DSR.Name&nbsp;=&nbsp;'.')&nbsp;or&nbsp;(DSR.Name&nbsp;=&nbsp;'..'))&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{dir}&nbsp;n:=&nbsp;CheckListBox.AddCheckBox(DSR.Name,&nbsp;'Папка',&nbsp;Level,&nbsp;True,&nbsp;True,&nbsp;False,&nbsp;True,&nbsp;TStringList.Create);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TStrings(CheckListBox.ItemObject[n]).Text:=&nbsp;AddBackslash(fromDir)&nbsp;+&nbsp;DSR.Name;<br>
{{Recursion}&nbsp;FillListBox(AddBackslash(fromDir)&nbsp;+&nbsp;DSR.Name,&nbsp;fileMask,&nbsp;true,&nbsp;Level&nbsp;+&nbsp;1);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FindResult:=&nbsp;FindNext(DSR);<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
Finally<br>
&nbsp;&nbsp;&nbsp;&nbsp;FindClose(FSR);&nbsp;FindClose(DSR);<br>
&nbsp;&nbsp;end;<br>
end;<br>
<br>
function&nbsp;HasChildren(Box:&nbsp;TNewCheckListBox;&nbsp;ItemIndex:&nbsp;integer):&nbsp;Boolean;<br>
begin<br>
&nbsp;&nbsp;if&nbsp;(ItemIndex&nbsp;=&nbsp;Box.Items.Count&nbsp;-&nbsp;1)&nbsp;or&nbsp;(Box.ItemLevel[ItemIndex+1]&nbsp;&lt;=&nbsp;Box.ItemLevel[ItemIndex])&nbsp;&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;Result:=&nbsp;False<br>
&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;Result:=&nbsp;True;<br>
end;<br>
<br>
procedure&nbsp;InvertOnClick(Sender:&nbsp;TObject);<br>
var<br>
&nbsp;&nbsp;i:&nbsp;integer;<br>
begin<br>
&nbsp;&nbsp;for&nbsp;i:=&nbsp;1&nbsp;to&nbsp;CheckListBox.Items.Count&nbsp;-&nbsp;1&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;Not&nbsp;HasChildren(CheckListBox,&nbsp;i)&nbsp;&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CheckListBox.Checked[i]:=&nbsp;Not&nbsp;(CheckListBox.State[i]&nbsp;=&nbsp;cbChecked);<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
end;<br>
<br>
procedure&nbsp;ButtonOnClick(Sender:&nbsp;TObject);<br>
begin<br>
///CheckListBox.Checked[0]:=&nbsp;TButton(Sender).Tag&nbsp;=&nbsp;0;<br>
if&nbsp;TButton(Sender).Tag&nbsp;=&nbsp;0&nbsp;then&nbsp;CheckListBox.CheckItem(0,&nbsp;coUncheck)&nbsp;else&nbsp;CheckListBox.CheckItem(0,&nbsp;coCheckWithChildren)	//:=&nbsp;TButton(Sender).Tag&nbsp;=&nbsp;0;<br>
end;<br>
<br>
procedure&nbsp;MsgButtonOnClick(Sender:&nbsp;TObject);<br>
begin<br>
&nbsp;&nbsp;Case&nbsp;TButton(Sender).Tag&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;bidDelAll&nbsp;:&nbsp;DelAllReadOnly:=&nbsp;True;<br>
&nbsp;&nbsp;&nbsp;&nbsp;bidSkipAll:&nbsp;SkipAllReadOnly:=&nbsp;True;<br>
&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;MsgForm.Close;<br>
end;<br>
<br>
function&nbsp;DelMsgBox(FileName:&nbsp;string):&nbsp;Boolean;<br>
var<br>
&nbsp;&nbsp;MsgLabel:&nbsp;TLabel;<br>
begin<br>
&nbsp;&nbsp;MsgForm:=&nbsp;CreateCustomForm;<br>
&nbsp;&nbsp;MsgForm.ClientWidth&nbsp;:=&nbsp;ScaleX(500);<br>
&nbsp;&nbsp;MsgForm.ClientHeight&nbsp;:=&nbsp;ScaleY(120);<br>
&nbsp;&nbsp;MsgForm.Caption&nbsp;:=&nbsp;'Files&nbsp;to&nbsp;delete';<br>
&nbsp;&nbsp;MsgForm.Center;<br>
<br>
&nbsp;&nbsp;MsgLabel&nbsp;:=&nbsp;TLabel.Create(MsgForm);<br>
&nbsp;&nbsp;MsgLabel.Left&nbsp;:=&nbsp;ScaleX(20);<br>
&nbsp;&nbsp;MsgLabel.Top&nbsp;:=&nbsp;ScaleY(20);<br>
&nbsp;&nbsp;MsgLabel.Caption:=&nbsp;FileName&nbsp;+&nbsp;'&nbsp;is&nbsp;protected&nbsp;file&nbsp;or&nbsp;directory&nbsp;!'&nbsp;+&nbsp;#10#10#13&nbsp;+&nbsp;'Do&nbsp;you&nbsp;want&nbsp;to&nbsp;delete&nbsp;the&nbsp;file&nbsp;with&nbsp;READONLY&nbsp;attribute&nbsp;?';<br>
&nbsp;&nbsp;MsgLabel.Parent&nbsp;:=&nbsp;MsgForm;<br>
<br>
&nbsp;&nbsp;MsgAllButton&nbsp;:=&nbsp;TButton.Create(MsgForm);<br>
&nbsp;&nbsp;MsgAllButton.Parent&nbsp;:=&nbsp;MsgForm;<br>
&nbsp;&nbsp;MsgAllButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;MsgAllButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;MsgAllButton.Left&nbsp;:=&nbsp;ScaleX(20);<br>
&nbsp;&nbsp;MsgAllButton.Top&nbsp;:=&nbsp;MsgForm.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;MsgAllButton.Caption&nbsp;:=&nbsp;'Delete&nbsp;All';<br>
&nbsp;&nbsp;MsgAllButton.Tag:=&nbsp;bidDelAll;<br>
&nbsp;&nbsp;MsgAllButton.OnClick&nbsp;:=&nbsp;@MsgButtonOnClick;<br>
<br>
&nbsp;&nbsp;MsgSkipAllButton&nbsp;:=&nbsp;TButton.Create(MsgForm);<br>
&nbsp;&nbsp;MsgSkipAllButton.Parent&nbsp;:=&nbsp;MsgForm;<br>
&nbsp;&nbsp;MsgSkipAllButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;MsgSkipAllButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;MsgSkipAllButton.Left&nbsp;:=&nbsp;MsgAllButton.Left&nbsp;+&nbsp;MsgAllButton.Width&nbsp;+&nbsp;ScaleX(10);<br>
&nbsp;&nbsp;MsgSkipAllButton.Top&nbsp;:=&nbsp;MsgForm.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;MsgSkipAllButton.Caption&nbsp;:=&nbsp;'Skip&nbsp;All';<br>
&nbsp;&nbsp;MsgSkipAllButton.Tag:=&nbsp;bidSkipAll;<br>
&nbsp;&nbsp;MsgSkipAllButton.OnClick&nbsp;:=&nbsp;@MsgButtonOnClick;<br>
<br>
&nbsp;&nbsp;MsgCancelButton&nbsp;:=&nbsp;TButton.Create(MsgForm);<br>
&nbsp;&nbsp;MsgCancelButton.Parent&nbsp;:=&nbsp;MsgForm;<br>
&nbsp;&nbsp;MsgCancelButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;MsgCancelButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;MsgCancelButton.Left&nbsp;:=&nbsp;MsgForm.ClientWidth&nbsp;-&nbsp;MsgCancelButton.Width&nbsp;-&nbsp;ScaleX(20);<br>
&nbsp;&nbsp;MsgCancelButton.Top&nbsp;:=&nbsp;MsgForm.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;MsgCancelButton.Caption&nbsp;:=&nbsp;'Skip';<br>
&nbsp;&nbsp;MsgCancelButton.ModalResult&nbsp;:=&nbsp;mrCancel;<br>
<br>
&nbsp;&nbsp;MsgDelButton&nbsp;:=&nbsp;TButton.Create(MsgForm);<br>
&nbsp;&nbsp;MsgDelButton.Parent&nbsp;:=&nbsp;MsgForm;<br>
&nbsp;&nbsp;MsgDelButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;MsgDelButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;MsgDelButton.Left&nbsp;:=&nbsp;MsgCancelButton.Left&nbsp;-&nbsp;MsgDelButton.Width&nbsp;-&nbsp;ScaleX(10);<br>
&nbsp;&nbsp;MsgDelButton.Top&nbsp;:=&nbsp;MsgForm.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;MsgDelButton.Caption&nbsp;:=&nbsp;'Delete';<br>
&nbsp;&nbsp;MsgDelButton.ModalResult&nbsp;:=&nbsp;mrOk;<br>
<br>
&nbsp;&nbsp;MsgForm.ActiveControl:=&nbsp;MsgCancelButton;<br>
<br>
&nbsp;&nbsp;if&nbsp;MsgForm.ShowModal()&nbsp;=&nbsp;mrOk&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;Result:=&nbsp;True<br>
&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;Result:=&nbsp;False;<br>
end;<br>
<br>
procedure&nbsp;DeleteFiles();<br>
var<br>
&nbsp;&nbsp;SR:&nbsp;TFindRec;<br>
&nbsp;&nbsp;i:&nbsp;integer;<br>
&nbsp;&nbsp;str:&nbsp;string;<br>
&nbsp;&nbsp;ResultCode:&nbsp;Integer;<br>
begin<br>
&nbsp;&nbsp;DelAllReadOnly:=&nbsp;False;<br>
&nbsp;&nbsp;SkipAllReadOnly:=&nbsp;False;<br>
<br>
&nbsp;&nbsp;for&nbsp;i:=&nbsp;CheckListBox.Items.Count&nbsp;-&nbsp;1&nbsp;downto&nbsp;0&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;CheckListBox.State[i]&nbsp;=&nbsp;cbChecked&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str:=&nbsp;Trim(TStrings(CheckListBox.ItemObject[i]).Text);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FindFirst(str,&nbsp;SR);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((SR.Attributes&nbsp;and&nbsp;FILE_ATTRIBUTE_READONLY)&nbsp;=&nbsp;FILE_ATTRIBUTE_READONLY)&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;Not&nbsp;(DelAllReadOnly&nbsp;or&nbsp;SkipAllReadOnly)&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;DelMsgBox(SR.Name)&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exec('attrib',&nbsp;'&nbsp;-h&nbsp;-s&nbsp;-r&nbsp;'&nbsp;+&nbsp;'&quot;'&nbsp;+&nbsp;str&nbsp;+&nbsp;'&quot;',&nbsp;'',&nbsp;SW_HIDE,&nbsp;ewWaitUntilTerminated,&nbsp;ResultCode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;DelAllReadOnly&nbsp;then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exec('attrib',&nbsp;'&nbsp;-h&nbsp;-s&nbsp;-r&nbsp;'&nbsp;+&nbsp;'&quot;'&nbsp;+&nbsp;str&nbsp;+&nbsp;'&quot;',&nbsp;'',&nbsp;SW_HIDE,&nbsp;ewWaitUntilTerminated,&nbsp;ResultCode);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FindClose(SR);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteFile(str);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RemoveDir(str);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
&nbsp;&nbsp;&nbsp;&nbsp;end;<br>
end;<br>
<br>
procedure&nbsp;BrowseRemainedFiles();<br>
begin<br>
&nbsp;&nbsp;Form:=&nbsp;CreateCustomForm;<br>
&nbsp;&nbsp;Form.ClientWidth&nbsp;:=&nbsp;ScaleX(500);<br>
&nbsp;&nbsp;Form.ClientHeight&nbsp;:=&nbsp;ScaleY(400);<br>
&nbsp;&nbsp;Form.Caption&nbsp;:=&nbsp;'Удаление&nbsp;оставшихся&nbsp;файлов';<br>
&nbsp;&nbsp;Form.Center;<br>
<br>
&nbsp;&nbsp;StaticText&nbsp;:=&nbsp;TNewStaticText.Create(Form);<br>
&nbsp;&nbsp;StaticText.Left:=&nbsp;ScaleX(7);<br>
&nbsp;&nbsp;StaticText.Top&nbsp;:=&nbsp;ScaleY(8);<br>
&nbsp;&nbsp;StaticText.Caption&nbsp;:=&nbsp;'Некоторые&nbsp;элементы&nbsp;не&nbsp;могли&nbsp;быть&nbsp;удалены.&nbsp;'&nbsp;+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Они&nbsp;могут&nbsp;быть&nbsp;удалены&nbsp;вручную.'&nbsp;+&nbsp;#13#10&nbsp;+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Выберите&nbsp;необходимые&nbsp;файлы&nbsp;для&nbsp;удаления&nbsp;'&nbsp;+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'или&nbsp;нажмите&nbsp;кнопку&nbsp;Отменить.';<br>
&nbsp;&nbsp;StaticText.Font.Color:=&nbsp;clBlue;<br>
&nbsp;&nbsp;StaticText.Font.Style:=&nbsp;[fsBold];<br>
&nbsp;&nbsp;StaticText.AutoSize:=&nbsp;True;<br>
&nbsp;&nbsp;StaticText.WordWrap:=&nbsp;True;<br>
&nbsp;&nbsp;StaticText.Parent&nbsp;:=&nbsp;Form;<br>
<br>
&nbsp;&nbsp;CheckListBox&nbsp;:=&nbsp;TNewCheckListBox.Create(Form);<br>
&nbsp;&nbsp;CheckListBox.Left:=&nbsp;ScaleX(20);<br>
&nbsp;&nbsp;CheckListBox.Top:=&nbsp;ScaleY(40);<br>
&nbsp;&nbsp;CheckListBox.Width:=&nbsp;Form.ClientWidth&nbsp;-&nbsp;ScaleX(20*2);<br>
&nbsp;&nbsp;CheckListBox.Height:=&nbsp;Form.ClientHeight&nbsp;-&nbsp;ScaleY(29*2&nbsp;+&nbsp;20);<br>
&nbsp;&nbsp;CheckListBox.Offset:=&nbsp;1;<br>
&nbsp;&nbsp;CheckListBox.Font.Name:=&nbsp;'Arial';<br>
&nbsp;&nbsp;CheckListBox.Font.Size:=&nbsp;9;<br>
&nbsp;&nbsp;CheckListBox.Parent:=&nbsp;Form;<br>
<br>
&nbsp;&nbsp;AllButton&nbsp;:=&nbsp;TButton.Create(Form);<br>
&nbsp;&nbsp;AllButton.Parent&nbsp;:=&nbsp;Form;<br>
&nbsp;&nbsp;AllButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;AllButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;AllButton.Left&nbsp;:=&nbsp;ScaleX(20);<br>
&nbsp;&nbsp;AllButton.Top&nbsp;:=&nbsp;Form.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;AllButton.Caption&nbsp;:=&nbsp;'Выбрать&nbsp;все';<br>
&nbsp;&nbsp;AllButton.Tag:=&nbsp;1;<br>
&nbsp;&nbsp;AllButton.OnClick&nbsp;:=&nbsp;@ButtonOnClick;<br>
<br>
&nbsp;&nbsp;UnAllButton&nbsp;:=&nbsp;TButton.Create(Form);<br>
&nbsp;&nbsp;UnAllButton.Parent&nbsp;:=&nbsp;Form;<br>
&nbsp;&nbsp;UnAllButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;UnAllButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;UnAllButton.Left&nbsp;:=&nbsp;AllButton.Left&nbsp;+&nbsp;AllButton.Width&nbsp;+&nbsp;ScaleX(10);<br>
&nbsp;&nbsp;UnAllButton.Top&nbsp;:=&nbsp;Form.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;UnAllButton.Caption&nbsp;:=&nbsp;'Отменит&nbsp;все';<br>
///UnAllButton.Tag:=&nbsp;1;<br>
&nbsp;&nbsp;UnAllButton.OnClick&nbsp;:=&nbsp;@ButtonOnClick;<br>
<br>
&nbsp;&nbsp;InvertButton&nbsp;:=&nbsp;TButton.Create(Form);<br>
&nbsp;&nbsp;InvertButton.Parent&nbsp;:=&nbsp;Form;<br>
&nbsp;&nbsp;InvertButton.Width&nbsp;:=&nbsp;ScaleX(89);<br>
&nbsp;&nbsp;InvertButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;InvertButton.Left&nbsp;:=&nbsp;UnAllButton.Left&nbsp;+&nbsp;UnAllButton.Width&nbsp;+&nbsp;ScaleX(10);<br>
&nbsp;&nbsp;InvertButton.Top&nbsp;:=&nbsp;Form.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;InvertButton.Caption&nbsp;:=&nbsp;'Инвертировать';<br>
&nbsp;&nbsp;InvertButton.OnClick&nbsp;:=&nbsp;@InvertOnClick;<br>
<br>
&nbsp;&nbsp;CancelButton&nbsp;:=&nbsp;TButton.Create(Form);<br>
&nbsp;&nbsp;CancelButton.Parent&nbsp;:=&nbsp;Form;<br>
&nbsp;&nbsp;CancelButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;CancelButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;CancelButton.Left&nbsp;:=&nbsp;Form.ClientWidth&nbsp;-&nbsp;CancelButton.Width&nbsp;-&nbsp;ScaleX(20);<br>
&nbsp;&nbsp;CancelButton.Top&nbsp;:=&nbsp;Form.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;CancelButton.Caption&nbsp;:=&nbsp;'Отмена';<br>
&nbsp;&nbsp;CancelButton.ModalResult&nbsp;:=&nbsp;mrCancel;<br>
&nbsp;&nbsp;CancelButton.Cancel&nbsp;:=&nbsp;True;<br>
<br>
&nbsp;&nbsp;DelButton&nbsp;:=&nbsp;TButton.Create(Form);<br>
&nbsp;&nbsp;DelButton.Parent&nbsp;:=&nbsp;Form;<br>
&nbsp;&nbsp;DelButton.Width&nbsp;:=&nbsp;ScaleX(75);<br>
&nbsp;&nbsp;DelButton.Height&nbsp;:=&nbsp;ScaleY(23);<br>
&nbsp;&nbsp;DelButton.Left&nbsp;:=&nbsp;CancelButton.Left&nbsp;-&nbsp;DelButton.Width&nbsp;-&nbsp;ScaleX(10);<br>
&nbsp;&nbsp;DelButton.Top&nbsp;:=&nbsp;Form.ClientHeight&nbsp;-&nbsp;ScaleY(23&nbsp;+&nbsp;10);<br>
&nbsp;&nbsp;DelButton.Caption&nbsp;:=&nbsp;'Удалить';<br>
&nbsp;&nbsp;DelButton.ModalResult&nbsp;:=&nbsp;mrOk;<br>
<br>
&nbsp;&nbsp;Form.ActiveControl:=&nbsp;CancelButton;<br>
<br>
&nbsp;&nbsp;FillListBox(ExpandConstant('{app}'),&nbsp;'*',&nbsp;true,&nbsp;1);<br>
<br>
///{список}&nbsp;for&nbsp;i:=&nbsp;CheckListBox.Items.Count&nbsp;-&nbsp;1&nbsp;downto&nbsp;1&nbsp;do&nbsp;SaveStringToFile(ExpandConstant('{sd}\RemainedFiles.txt'),&nbsp;CheckListBox.Items[i]&nbsp;+&nbsp;#9&nbsp;+&nbsp;CheckListBox.ItemSubItem[i]&nbsp;+&nbsp;#13#10,&nbsp;True);<br>
<br>
&nbsp;&nbsp;if&nbsp;Form.ShowModal()&nbsp;=&nbsp;mrOk&nbsp;then&nbsp;&nbsp;DeleteFiles();<br>
end;<br>
<br>
procedure&nbsp;CurUninstallStepChanged(CurUninstallStep:&nbsp;TUninstallStep);<br>
begin<br>
&nbsp;&nbsp;if&nbsp;DirExists(ExpandConstant('{app}'))&nbsp;and&nbsp;(CurUninstallStep&nbsp;=&nbsp;usPostUninstall)&nbsp;then&nbsp;BrowseRemainedFiles();<br>
end;<br>
</font></blockquote><textarea id="taCode1" style="display:none;" rows="1" cols="5"></textarea><textarea id='taCode' style='display:none;' rows='1' cols='20'></textarea></code><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTM','delphi');</script><br><div id="heading"><h1><font size="1" face="Consolas">Copyright (c) <a href="http://www.krinkels.org/" target="_blank">Krinkels Inc</a></font></h1></div></body></html>