<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>Регулятор громкости</title><link rel="stylesheet" type="text/css" href="css.css"><script type="text/javascript" src="includer.js"></script><script language='jscript' type='text/javascript' src='copycode.js'></script></head><body><div id="heading"><h1>» Inno Setup Faq. Регулятор громкости</h1></div><br><script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTM"> <input type="button" value="Копировать в буфер обмена" onClick="copyToClipboard( taCode1, theCode1 );"> <blockquote id="theCode1"><font>[Setup]<br>AppName=Team Fortress 2<br>AppVerName=Team Fortress 2 - v1.0.5.8 (3847)<br>DefaultDirName={pf}\Team Fortress 2<br>DefaultGroupName=Team Fortress 2<br><br>[Files]<br>Source: Files\*; DestDir:{tmp}; Flags: dontcopy<br><br>[Code]<br>type<br>HSTREAM = DWORD;<br><br>function BASS_Init(device: Integer; freq, flags: DWORD; win: hwnd; CLSID: Integer): Boolean;<br>external 'BASS_Init@files:BASS.dll stdcall delayload';<br><br>function BASS_StreamCreateFile(mem: BOOL; f: PChar; offset: DWORD; length: DWORD; flags: DWORD): HSTREAM;<br>external 'BASS_StreamCreateFile@files:BASS.dll stdcall delayload';<br><br>function BASS_Start(): Boolean;<br>external 'BASS_Start@files:BASS.dll stdcall delayload';<br><br>function BASS_Pause(): Boolean;<br>external 'BASS_Pause@files:BASS.dll stdcall delayload';<br><br>function BASS_SetVolume(volume: DWORD): BOOL;<br>external 'BASS_SetVolume@files:BASS.dll stdcall delayload';<br><br>function BASS_GetVolume: Integer;<br>external 'BASS_GetVolume@files:BASS.dll stdcall delayload';<br><br>function BASS_ChannelPlay(handle: DWORD; restart: BOOL): Boolean;<br>external 'BASS_ChannelPlay@files:BASS.dll stdcall delayload';<br><br>function BASS_Stop(): Boolean;<br>external 'BASS_Stop@files:BASS.dll stdcall delayload';<br><br>function BASS_Free(): Boolean;<br>external 'BASS_Free@files:BASS.dll stdcall delayload';<br><br>function GetSystemMetrics(nIndex:Integer):Integer;<br>external 'GetSystemMetrics@user32.dll stdcall';<br><br>const<br>BASS_SAMPLE_LOOP = 4; ///повторение<br><br>var<br>MusicButton, VolumeUP, VolumeDown : TButton;<br>VolumeInd: TNewProgressBar;<br><br>///Событие при нажатии на кнопку вкл.выкл. музыки<br>procedure MusicButtonOnClick(Sender: TObject);<br>begin<br>///Проверка состояния кнопки<br>if MusicButton.Caption = 'II' then ///Если играет<br>begin<br>MusicButton.Caption := '&gt;';<br>BASS_Pause; ///Тушим<br>end else ///Иначе<br>begin<br>MusicButton.Caption := 'II';<br>BASS_Start(); ///Слушаем<br>end;<br>end;<br><br>///Нажатие на кнопочку увеличения громкости<br>procedure VolumeUPOnClick(Sender: TObject);<br>var<br>vol : integer;<br>begin<br>vol := BASS_GetVolume;<br>if vol+5 &gt;= 100 then ///Добавляем громкости сразу на 5 единиц<br>begin<br>BASS_SETVolume(100);<br>VolumeIND.position := 100;<br>VolumeUP.Enabled := False; ///Если громкость максимальная то выключим кнопку<br>end else<br>begin<br>BASS_SETVolume(vol+5);<br>VolumeIND.position := vol+5;<br>VolumeDOWN.Enabled := True;<br>end;<br>end;<br><br>///Конопка понижение громкости<br>procedure VolumeDOWNOnClick(Sender: TObject);<br>var<br>vol : integer;<br>begin<br>vol := BASS_GetVolume;<br>if vol-5 &lt;= 0 then<br>begin<br>BASS_SETVolume(0);<br>VolumeIND.position := 0;<br>VolumeDOWN.Enabled := False; ///Если понижать уже некуда то выключаем кнопочку<br>end else<br>begin<br>BASS_SETVolume(vol-5);<br>VolumeIND.position := vol-5;<br>VolumeUP.Enabled := True;<br>end;<br>end;<br><br>///Иницализация окна установки<br>procedure InitializeWizard;<br>var<br>s, Name: string;<br>i : Integer;<br>begin<br>///Загружаем музыку<br>ExtractTemporaryFile('BASS.dll');<br>ExtractTemporaryFile('gamestartup.mp3');<br>if BASS_Init(-1, 44100, 0, 0, 0) then<br>begin<br>BASS_Start();<br>Name:=ExpandConstant('{tmp}\gamestartup.mp3');<br>i:=BASS_StreamCreateFile(FALSE, PChar(Name), 0, 0, 4);<br>if i &lt;&gt; 0 then<br>begin<br>BASS_ChannelPlay(i, True);<br>end;<br>end;<br><br>///Добавляем кнопочки управления музыкой<br>///Вкл. Выкл.<br>MusicButton := TButton.Create(WizardForm);<br>with MusicButton do<br>begin<br>Left := WizardForm.ClientWidth - WizardForm.CancelButton.Left - WizardForm.CancelButton.Width;<br>Top := WizardForm.CancelButton.Top;<br>Width := WizardForm.CancelButton.Height;<br>Height := WizardForm.CancelButton.Height;<br>Caption := 'II';<br>Hint := 'Вкл.Выкл. музыку';<br>ShowHint := True;<br>OnClick := @MusicButtonOnClick;<br>Parent := WizardForm;<br>end;<br><br>///Громче<br>VolumeDown := TButton.Create(WizardForm);<br>with VolumeDown do<br>begin<br>Left := WizardForm.ClientWidth - WizardForm.CancelButton.Left - WizardForm.CancelButton.Width + MusicButton.Width;<br>Top := WizardForm.CancelButton.Top;<br>Width := WizardForm.CancelButton.Height;<br>Height := WizardForm.CancelButton.Height;<br>Caption := '-';<br>Hint := 'Убавить громкость';<br>ShowHint := True;<br>OnClick := @VolumeDOWNOnClick;<br>Parent := WizardForm;<br>end;<br><br>///Тише<br>VolumeUP := TButton.Create(WizardForm);<br>with VolumeUP do<br>begin<br>Left := WizardForm.ClientWidth - WizardForm.CancelButton.Left - WizardForm.CancelButton.Width + MusicButton.Width + VolumeDown.Width;<br>Top := WizardForm.CancelButton.Top;<br>Width := WizardForm.CancelButton.Height;<br>Height := WizardForm.CancelButton.Height;<br>Caption := '+';<br>Hint := 'Прибавить громкость';<br>ShowHint := True;<br>OnClick := @VolumeUPOnClick;<br>Parent := WizardForm;<br>end;<br><br>///Индикатор уровня громкости<br>VolumeIND := TNewProgressBar.Create(WizardForm);<br>with VolumeIND do<br>begin<br>Parent := WizardForm;<br>Left := WizardForm.ClientWidth - WizardForm.CancelButton.Left - WizardForm.CancelButton.Width + MusicButton.Width + VolumeUP.Width + VolumeDown.Width;<br>Top := WizardForm.CancelButton.Top;<br>Width := WizardForm.CancelButton.Width;<br>Height := WizardForm.CancelButton.Height;<br>Min := 0;<br>Max := 100;<br>Position := BASS_GetVolume;<br>end;<br><br>///Проверка на то какая громкость стоит в системе<br>if BASS_GetVolume &gt;= 100 then volumeUP.Enabled := False;<br>if BASS_GetVolume &lt;= 0 then volumeDOWN.Enabled := False;<br><br>end;<br><br>procedure DeinitializeSetup();<br>begin<br>BASS_Stop(); ///нужно для остановки проигрывания<br>BASS_Free(); ///нужно для быстрой выгрузки библиотеки вместе с муз. файлом<br>end;</font></blockquote><textarea id="taCode1" style="display:none;" rows="1" cols="5"></textarea><textarea id='taCode' style='display:none;' rows='1' cols='20'></textarea></code><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTM','delphi');</script><br><div id="heading"><h1><font size="1" face="Consolas">Copyright (c) <a href="http://www.krinkels.org/" target="_blank">Krinkels Inc</a></font></h1></div></body></html>