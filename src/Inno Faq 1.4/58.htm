<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>RecodeOgg.</title><link rel="stylesheet" type="text/css" href="css.css"><script type="text/javascript" src="includer.js"></script><script language='jscript' type='text/javascript' src='copycode.js'></script></head><body><div id="heading"><h1>» Inno Setup Faq. RecodeOgg.</h1></div><br><script language="javascript" type="text/javascript">includeSyntax('delphi');</script><code id="delphi_Tc4NTM"> <input type="button" value="Копировать в буфер обмена" onClick="copyToClipboard( taCode1, theCode1 );"> <blockquote id="theCode1"><font>[Setup]<br>AppName=RecodeOgg<br>AppVerName=RecodeOgg<br>OutputDir=.<br>OutputBaseFilename=RecodeOgg<br>DefaultDirName={pf}\RecodeOgg<br>AppendDefaultDirName=False<br>DisableDirPage=True<br><br>[Files]<br>Source: oggdec.exe; DestDir: {app};<br>Source: oggs\*; DestDir: {app};<br>Source: oggs\*; DestDir: {app}\Data;<br><br>[Code]<br>var<br>Files: Array of String;<br>S: String;<br>n: Integer;<br><br>function StringToArray(Text, Cut: String): array of String; var i, k: Integer;<br>Begin<br>SetArrayLength(Result, 0); if Cut = '' then Cut:= #1310; ///если шаблон пуст, считаем переводы строк<br>Repeat k:= Pos(Cut,Text);<br>if k = 1 then begin Delete(Text, 1, Length(Cut)); CONTINUE<br>end;<br>SetArrayLength(Result, GetArrayLength(Result) +1); i:= GetArrayLength(Result) -1;<br>if k = 0 then<br>Result[i]:=Text<br>else begin<br>Result[i]:= Copy(Text, 1, k -1); Delete(Text, 1, Length(Result[i]) + Length(Cut));<br>end;<br>Until Length(Text) * k = 0;<br>end;<br><br>procedure FindFiles(FromDir: String; Mask: String);<br>var FSR, DSR: TFindRec; FindResult: Boolean;<br>begin<br>FindResult:= FindFirst(AddBackslash(FromDir)+Mask, FSR)<br>while FindResult do begin<br>if FSR.Attributes and FILE_ATTRIBUTE_DIRECTORY = 0 then begin<br>S:= S + AddBackslash(fromDir) + FSR.Name +'|';<br>end;<br>FindResult:= FindNext(FSR);<br>end;<br>FindResult:= FindFirst(AddBackslash(FromDir)+ '*.*', DSR)<br>while FindResult do begin<br>if ((DSR.Attributes and FILE_ATTRIBUTE_DIRECTORY) = FILE_ATTRIBUTE_DIRECTORY) and not ((DSR.Name = '.') or (DSR.Name = '..')) then begin<br>FindFiles(AddBackSlash(FromDir)+DSR.Name, Mask)<br>end;<br>FindResult:= FindNext(DSR);<br>end;<br>FindClose(FSR); FindClose(DSR)<br>end;<br><br>procedure RecodeOgg;<br>var ResultCode: integer; CurFile: String;<br>begin<br>FindFiles(ExpandConstant('{app}'), '*.ogg') ///Находим все файлы по маске, в выбранной папке<br>Files:= StringToArray(S, '|') ///Переводим в массив<br>WizardForm.ProgressGauge.Max:= GetArrayLength(Files)-1; ///Получаем кол-во файлов<br>for n:=(GetArrayLength(Files)-1) downto 0 do begin<br>CurFile:= Files[n]<br>StringChange(CurFile, AddBackslash(ExpandConstant('{app}')), '')<br>Exec(ExpandConstant('{app}\oggdec.exe'), '-Q '+CurFile, '', SW_Hide, EwWaitUntilTerminated, ResultCode) ///Для каждого файла запускаем декодер<br>DeleteFile(Files[n]) ///Удаляем ненужный файл<br>WizardForm.FilenameLabel.Caption:= Files[n]; ///Двигаем прогрессбар<br>WizardForm.ProgressGauge.Position:= WizardForm.ProgressGauge.Position +1;<br>end;<br>DeleteFile(ExpandConstant('{app}\oggdec.exe'))<br>end;<br><br>procedure CurStepChanged(CurStep: TSetupStep);<br>begin<br>if CurStep = ssPostInstall then RecodeOgg;<br>end;</font></blockquote><textarea id="taCode1" style="display:none;" rows="1" cols="5"></textarea><textarea id='taCode' style='display:none;' rows='1' cols='20'></textarea></code><script language="javascript" type="text/javascript">highlightSyntax('delphi_Tc4NTM','delphi');</script><br><div id="heading"><h1><font size="1" face="Consolas">Copyright (c) <a href="http://www.krinkels.org/" target="_blank">Krinkels Inc</a></font></h1></div></body></html>